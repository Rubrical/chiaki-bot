var Bn=Object.create;var Ye=Object.defineProperty;var Nn=Object.getOwnPropertyDescriptor;var Pn=Object.getOwnPropertyNames;var Tn=Object.getPrototypeOf,Gn=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Un=(e,t)=>{for(var i in t)Ye(e,i,{get:t[i],enumerable:!0})},qn=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Pn(t))!Gn.call(e,n)&&n!==i&&Ye(e,n,{get:()=>t[n],enumerable:!(r=Nn(t,n))||r.enumerable});return e};var B=(e,t,i)=>(i=e!=null?Bn(Tn(e)):{},qn(t||!e||!e.__esModule?Ye(i,"default",{value:e,enumerable:!0}):i,e));var Ze=I((Bf,fr)=>{"use strict";var he=e=>e&&typeof e.message=="string",Qe=e=>{if(!e)return;let t=e.cause;if(typeof t=="function"){let i=e.cause();return he(i)?i:void 0}else return he(t)?t:void 0},ur=(e,t)=>{if(!he(e))return"";let i=e.stack||"";if(t.has(e))return i+`
causes have become circular...`;let r=Qe(e);return r?(t.add(e),i+`
caused by: `+ur(r,t)):i},jn=e=>ur(e,new Set),lr=(e,t,i)=>{if(!he(e))return"";let r=i?"":e.message||"";if(t.has(e))return r+": ...";let n=Qe(e);if(n){t.add(e);let o=typeof e.cause=="function";return r+(o?"":": ")+lr(n,t,o)}else return r},Dn=e=>lr(e,new Set);fr.exports={isErrorLike:he,getErrorCause:Qe,stackWithCauses:jn,messageWithCauses:Dn}});var et=I((Nf,mr)=>{"use strict";var Ln=Symbol("circular-ref-tag"),Ce=Symbol("pino-raw-err-ref"),dr=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[Ce]},set:function(e){this[Ce]=e}}});Object.defineProperty(dr,Ce,{writable:!0,value:{}});mr.exports={pinoErrProto:dr,pinoErrorSymbols:{seen:Ln,rawSymbol:Ce}}});var hr=I((Pf,pr)=>{"use strict";pr.exports=rt;var{messageWithCauses:Jn,stackWithCauses:zn,isErrorLike:gr}=Ze(),{pinoErrProto:Wn,pinoErrorSymbols:Fn}=et(),{seen:tt}=Fn,{toString:Vn}=Object.prototype;function rt(e){if(!gr(e))return e;e[tt]=void 0;let t=Object.create(Wn);t.type=Vn.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=Jn(e),t.stack=zn(e),Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(i=>rt(i)));for(let i in e)if(t[i]===void 0){let r=e[i];gr(r)?i!=="cause"&&!Object.prototype.hasOwnProperty.call(r,tt)&&(t[i]=rt(r)):t[i]=r}return delete e[tt],t.raw=e,t}});var wr=I((Tf,yr)=>{"use strict";yr.exports=Ee;var{isErrorLike:it}=Ze(),{pinoErrProto:Kn,pinoErrorSymbols:Hn}=et(),{seen:ke}=Hn,{toString:Xn}=Object.prototype;function Ee(e){if(!it(e))return e;e[ke]=void 0;let t=Object.create(Kn);t.type=Xn.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=e.message,t.stack=e.stack,Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(i=>Ee(i))),it(e.cause)&&!Object.prototype.hasOwnProperty.call(e.cause,ke)&&(t.cause=Ee(e.cause));for(let i in e)if(t[i]===void 0){let r=e[i];it(r)?Object.prototype.hasOwnProperty.call(r,ke)||(t[i]=Ee(r)):t[i]=r}return delete e[ke],t.raw=e,t}});var xr=I((Gf,Sr)=>{"use strict";Sr.exports={mapHttpRequest:Yn,reqSerializer:vr};var ot=Symbol("pino-raw-req-ref"),br=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[ot]},set:function(e){this[ot]=e}}});Object.defineProperty(br,ot,{writable:!0,value:{}});function vr(e){let t=e.info||e.socket,i=Object.create(br);if(i.id=typeof e.id=="function"?e.id():e.id||(e.info?e.info.id:void 0),i.method=e.method,e.originalUrl)i.url=e.originalUrl;else{let r=e.path;i.url=typeof r=="string"?r:e.url?e.url.path||e.url:void 0}return e.query&&(i.query=e.query),e.params&&(i.params=e.params),i.headers=e.headers,i.remoteAddress=t&&t.remoteAddress,i.remotePort=t&&t.remotePort,i.raw=e.raw||e,i}function Yn(e){return{req:vr(e)}}});var $r=I((Uf,Er)=>{"use strict";Er.exports={mapHttpResponse:Qn,resSerializer:kr};var nt=Symbol("pino-raw-res-ref"),Cr=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[nt]},set:function(e){this[nt]=e}}});Object.defineProperty(Cr,nt,{writable:!0,value:{}});function kr(e){let t=Object.create(Cr);return t.statusCode=e.headersSent?e.statusCode:null,t.headers=e.getHeaders?e.getHeaders():e._headers,t.raw=e,t}function Qn(e){return{res:kr(e)}}});var at=I((qf,Ir)=>{"use strict";var st=hr(),Zn=wr(),$e=xr(),Ie=$r();Ir.exports={err:st,errWithCause:Zn,mapHttpRequest:$e.mapHttpRequest,mapHttpResponse:Ie.mapHttpResponse,req:$e.reqSerializer,res:Ie.resSerializer,wrapErrorSerializer:function(t){return t===st?t:function(r){return t(st(r))}},wrapRequestSerializer:function(t){return t===$e.reqSerializer?t:function(r){return t($e.reqSerializer(r))}},wrapResponseSerializer:function(t){return t===Ie.resSerializer?t:function(r){return t(Ie.resSerializer(r))}}}});var ct=I((jf,Or)=>{"use strict";function es(e,t){return t}Or.exports=function(){let t=Error.prepareStackTrace;Error.prepareStackTrace=es;let i=new Error().stack;if(Error.prepareStackTrace=t,!Array.isArray(i))return;let r=i.slice(2),n=[];for(let o of r)o&&n.push(o.getFileName());return n}});var Mr=I((Df,Ar)=>{"use strict";Ar.exports=ts;function ts(e={}){let{ERR_PATHS_MUST_BE_STRINGS:t=()=>"fast-redact - Paths must be (non-empty) strings",ERR_INVALID_PATH:i=r=>`fast-redact \u2013 Invalid path (${r})`}=e;return function({paths:n}){n.forEach(o=>{if(typeof o!="string")throw Error(t());try{if(/ã€‡/.test(o))throw Error();let s=(o[0]==="["?"":".")+o.replace(/^\*/,"\u3007").replace(/\.\*/g,".\u3007").replace(/\[\*\]/g,"[\u3007]");if(/\n|\r|;/.test(s)||/\/\*/.test(s))throw Error();Function(`
            'use strict'
            const o = new Proxy({}, { get: () => o, set: () => { throw Error() } });
            const \u3007 = null;
            o${s}
            if ([o${s}].length !== 1) throw Error()`)()}catch{throw Error(i(o))}})}}});var Oe=I((Lf,_r)=>{"use strict";_r.exports=/[^.[\]]+|\[((?:.)*?)\]/g});var Br=I((Jf,Rr)=>{"use strict";var rs=Oe();Rr.exports=is;function is({paths:e}){let t=[];var i=0;let r=e.reduce(function(n,o,s){var a=o.match(rs).map(f=>f.replace(/'|"|`/g,""));let c=o[0]==="[";a=a.map(f=>f[0]==="["?f.substr(1,f.length-2):f);let m=a.indexOf("*");if(m>-1){let f=a.slice(0,m),u=f.join("."),g=a.slice(m+1,a.length),d=g.length>0;i++,t.push({before:f,beforeStr:u,after:g,nested:d})}else n[o]={path:a,val:void 0,precensored:!1,circle:"",escPath:JSON.stringify(o),leadingBracket:c};return n},{});return{wildcards:t,wcLen:i,secret:r}}});var Pr=I((zf,Nr)=>{"use strict";var os=Oe();Nr.exports=ns;function ns({secret:e,serialize:t,wcLen:i,strict:r,isCensorFct:n,censorFctTakesPath:o},s){let a=Function("o",`
    if (typeof o !== 'object' || o == null) {
      ${us(r,t)}
    }
    const { censor, secret } = this
    const originalSecret = {}
    const secretKeys = Object.keys(secret)
    for (var i = 0; i < secretKeys.length; i++) {
      originalSecret[secretKeys[i]] = secret[secretKeys[i]]
    }

    ${ss(e,n,o)}
    this.compileRestore()
    ${as(i>0,n,o)}
    this.secret = originalSecret
    ${cs(t)}
  `).bind(s);return a.state=s,t===!1&&(a.restore=c=>s.restore(c)),a}function ss(e,t,i){return Object.keys(e).map(r=>{let{escPath:n,leadingBracket:o,path:s}=e[r],a=o?1:0,c=o?"":".",m=[];for(var f;(f=os.exec(r))!==null;){let[,l]=f,{index:h,input:w}=f;h>a&&m.push(w.substring(0,h-(l?0:1)))}var u=m.map(l=>`o${c}${l}`).join(" && ");u.length===0?u+=`o${c}${r} != null`:u+=` && o${c}${r} != null`;let g=`
      switch (true) {
        ${m.reverse().map(l=>`
          case o${c}${l} === censor:
            secret[${n}].circle = ${JSON.stringify(l)}
            break
        `).join(`
`)}
      }
    `,d=i?`val, ${JSON.stringify(s)}`:"val";return`
      if (${u}) {
        const val = o${c}${r}
        if (val === censor) {
          secret[${n}].precensored = true
        } else {
          secret[${n}].val = val
          o${c}${r} = ${t?`censor(${d})`:"censor"}
          ${g}
        }
      }
    `}).join(`
`)}function as(e,t,i){return e===!0?`
    {
      const { wildcards, wcLen, groupRedact, nestedRedact } = this
      for (var i = 0; i < wcLen; i++) {
        const { before, beforeStr, after, nested } = wildcards[i]
        if (nested === true) {
          secret[beforeStr] = secret[beforeStr] || []
          nestedRedact(secret[beforeStr], o, before, after, censor, ${t}, ${i})
        } else secret[beforeStr] = groupRedact(o, before, censor, ${t}, ${i})
      }
    }
  `:""}function cs(e){return e===!1?"return o":`
    var s = this.serialize(o)
    this.restore(o)
    return s
  `}function us(e,t){return e===!0?"throw Error('fast-redact: primitives cannot be redacted')":t===!1?"return o":"return this.serialize(o)"}});var lt=I((Wf,Ur)=>{"use strict";Ur.exports={groupRedact:fs,groupRestore:ls,nestedRedact:ms,nestedRestore:ds};function ls({keys:e,values:t,target:i}){if(i==null||typeof i=="string")return;let r=e.length;for(var n=0;n<r;n++){let o=e[n];i[o]=t[n]}}function fs(e,t,i,r,n){let o=Tr(e,t);if(o==null||typeof o=="string")return{keys:null,values:null,target:o,flat:!0};let s=Object.keys(o),a=s.length,c=t.length,m=n?[...t]:void 0,f=new Array(a);for(var u=0;u<a;u++){let g=s[u];f[u]=o[g],n?(m[c]=g,o[g]=i(o[g],m)):r?o[g]=i(o[g]):o[g]=i}return{keys:s,values:f,target:o,flat:!0}}function ds(e){for(let t=0;t<e.length;t++){let{target:i,path:r,value:n}=e[t],o=i;for(let s=r.length-1;s>0;s--)o=o[r[s]];o[r[0]]=n}}function ms(e,t,i,r,n,o,s){let a=Tr(t,i);if(a==null)return;let c=Object.keys(a),m=c.length;for(var f=0;f<m;f++){let u=c[f];gs(e,a,u,i,r,n,o,s)}return e}function ut(e,t){return e!=null?"hasOwn"in Object?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t):!1}function gs(e,t,i,r,n,o,s,a){let c=n.length,m=c-1,f=i;var u=-1,g,d,l,h=null,w=null,v,b,S=!1,x=0,E=0,O=ps();if(l=g=t[i],typeof g=="object"){for(;g!=null&&++u<c&&(E+=1,i=n[u],h=l,!(i!=="*"&&!w&&!(typeof g=="object"&&i in g)));)if(!(i==="*"&&(w==="*"&&(S=!0),w=i,u!==m))){if(w){let M=Object.keys(g);for(var A=0;A<M.length;A++){let C=M[A];if(b=g[C],v=i==="*",S)O=X(O,C,E),x=u,l=Gr(b,x-1,i,r,n,o,s,a,f,g,d,l,v,C,u,m,O,e,t[f],E+1);else if(v||typeof b=="object"&&b!==null&&i in b){if(v?l=b:l=b[i],d=u!==m?l:s?a?o(l,[...r,f,...n]):o(l):o,v){let R=ye(X(O,C,E),l,t[f]);e.push(R),g[C]=d}else if(b[i]!==d)if(d===void 0&&o!==void 0||ut(b,i)&&d===l)O=X(O,C,E);else{O=X(O,C,E);let R=ye(X(O,i,E+1),l,t[f]);e.push(R),b[i]=d}}}w=null}else{if(l=g[i],O=X(O,i,E),d=u!==m?l:s?a?o(l,[...r,f,...n]):o(l):o,!(ut(g,i)&&d===l||d===void 0&&o!==void 0)){let M=ye(O,l,t[f]);e.push(M),g[i]=d}g=g[i]}if(typeof g!="object")break}}}function Tr(e,t){for(var i=-1,r=t.length,n=e;n!=null&&++i<r;)n=n[t[i]];return n}function Gr(e,t,i,r,n,o,s,a,c,m,f,u,g,d,l,h,w,v,b,S){if(t===0&&(g||typeof e=="object"&&e!==null&&i in e)){if(g?u=e:u=e[i],f=l!==h?u:s?a?o(u,[...r,c,...n]):o(u):o,g){let x=ye(w,u,b);v.push(x),m[d]=f}else if(e[i]!==f){if(!(f===void 0&&o!==void 0||ut(e,i)&&f===u)){let x=ye(X(w,i,S+1),u,b);v.push(x),e[i]=f}}}for(let x in e)typeof e[x]=="object"&&(w=X(w,x,S),Gr(e[x],t-1,i,r,n,o,s,a,c,m,f,u,g,d,l,h,w,v,b,S+1))}function ps(){return{parent:null,key:null,children:[],depth:0}}function X(e,t,i){if(e.depth===i)return X(e.parent,t,i);var r={parent:e,key:t,depth:i,children:[]};return e.children.push(r),r}function ye(e,t,i){let r=e,n=[];do n.push(r.key),r=r.parent;while(r.parent!=null);return{path:n,value:t,target:i}}});var jr=I((Ff,qr)=>{"use strict";var{groupRestore:hs,nestedRestore:ys}=lt();qr.exports=ws;function ws(){return function(){if(this.restore){this.restore.state.secret=this.secret;return}let{secret:t,wcLen:i}=this,r=Object.keys(t),n=bs(t,r),o=i>0,s=o?{secret:t,groupRestore:hs,nestedRestore:ys}:{secret:t};this.restore=Function("o",vs(n,r,o)).bind(s),this.restore.state=s}}function bs(e,t){return t.map(i=>{let{circle:r,escPath:n,leadingBracket:o}=e[i],a=r?`o.${r} = secret[${n}].val`:`o${o?"":"."}${i} = secret[${n}].val`,c=`secret[${n}].val = undefined`;return`
      if (secret[${n}].val !== undefined) {
        try { ${a} } catch (e) {}
        ${c}
      }
    `}).join("")}function vs(e,t,i){return`
    const secret = this.secret
    ${i===!0?`
    const keys = Object.keys(secret)
    const len = keys.length
    for (var i = len - 1; i >= ${t.length}; i--) {
      const k = keys[i]
      const o = secret[k]
      if (o) {
        if (o.flat === true) this.groupRestore(o)
        else this.nestedRestore(o)
        secret[k] = null
      }
    }
  `:""}
    ${e}
    return o
  `}});var Lr=I((Vf,Dr)=>{"use strict";Dr.exports=Ss;function Ss(e){let{secret:t,censor:i,compileRestore:r,serialize:n,groupRedact:o,nestedRedact:s,wildcards:a,wcLen:c}=e,m=[{secret:t,censor:i,compileRestore:r}];return n!==!1&&m.push({serialize:n}),c>0&&m.push({groupRedact:o,nestedRedact:s,wildcards:a,wcLen:c}),Object.assign(...m)}});var Wr=I((Kf,zr)=>{"use strict";var Jr=Mr(),xs=Br(),Cs=Pr(),ks=jr(),{groupRedact:Es,nestedRedact:$s}=lt(),Is=Lr(),Os=Oe(),As=Jr(),ft=e=>e;ft.restore=ft;var Ms="[REDACTED]";dt.rx=Os;dt.validator=Jr;zr.exports=dt;function dt(e={}){let t=Array.from(new Set(e.paths||[])),i="serialize"in e&&(e.serialize===!1||typeof e.serialize=="function")?e.serialize:JSON.stringify,r=e.remove;if(r===!0&&i!==JSON.stringify)throw Error("fast-redact \u2013 remove option may only be set when serializer is JSON.stringify");let n=r===!0?void 0:"censor"in e?e.censor:Ms,o=typeof n=="function",s=o&&n.length>1;if(t.length===0)return i||ft;As({paths:t,serialize:i,censor:n});let{wildcards:a,wcLen:c,secret:m}=xs({paths:t,censor:n}),f=ks(),u="strict"in e?e.strict:!0;return Cs({secret:m,wcLen:c,serialize:i,strict:u,isCensorFct:o,censorFctTakesPath:s},Is({secret:m,censor:n,compileRestore:f,serialize:i,groupRedact:Es,nestedRedact:$s,wildcards:a,wcLen:c}))}});var ae=I((Hf,Fr)=>{"use strict";var _s=Symbol("pino.setLevel"),Rs=Symbol("pino.getLevel"),Bs=Symbol("pino.levelVal"),Ns=Symbol("pino.levelComp"),Ps=Symbol("pino.useLevelLabels"),Ts=Symbol("pino.useOnlyCustomLevels"),Gs=Symbol("pino.mixin"),Us=Symbol("pino.lsCache"),qs=Symbol("pino.chindings"),js=Symbol("pino.asJson"),Ds=Symbol("pino.write"),Ls=Symbol("pino.redactFmt"),Js=Symbol("pino.time"),zs=Symbol("pino.timeSliceIndex"),Ws=Symbol("pino.stream"),Fs=Symbol("pino.stringify"),Vs=Symbol("pino.stringifySafe"),Ks=Symbol("pino.stringifiers"),Hs=Symbol("pino.end"),Xs=Symbol("pino.formatOpts"),Ys=Symbol("pino.messageKey"),Qs=Symbol("pino.errorKey"),Zs=Symbol("pino.nestedKey"),ea=Symbol("pino.nestedKeyStr"),ta=Symbol("pino.mixinMergeStrategy"),ra=Symbol("pino.msgPrefix"),ia=Symbol("pino.wildcardFirst"),oa=Symbol.for("pino.serializers"),na=Symbol.for("pino.formatters"),sa=Symbol.for("pino.hooks"),aa=Symbol.for("pino.metadata");Fr.exports={setLevelSym:_s,getLevelSym:Rs,levelValSym:Bs,levelCompSym:Ns,useLevelLabelsSym:Ps,mixinSym:Gs,lsCacheSym:Us,chindingsSym:qs,asJsonSym:js,writeSym:Ds,serializersSym:oa,redactFmtSym:Ls,timeSym:Js,timeSliceIndexSym:zs,streamSym:Ws,stringifySym:Fs,stringifySafeSym:Vs,stringifiersSym:Ks,endSym:Hs,formatOptsSym:Xs,messageKeySym:Ys,errorKeySym:Qs,nestedKeySym:Zs,wildcardFirstSym:ia,needsMetadataGsym:aa,useOnlyCustomLevelsSym:Ts,formattersSym:na,hooksSym:sa,nestedKeyStrSym:ea,mixinMergeStrategySym:ta,msgPrefixSym:ra}});var pt=I((Xf,Xr)=>{"use strict";var gt=Wr(),{redactFmtSym:ca,wildcardFirstSym:Ae}=ae(),{rx:mt,validator:ua}=gt,Vr=ua({ERR_PATHS_MUST_BE_STRINGS:()=>"pino \u2013 redacted paths must be strings",ERR_INVALID_PATH:e=>`pino \u2013 redact paths array contains an invalid path (${e})`}),Kr="[Redacted]",Hr=!1;function la(e,t){let{paths:i,censor:r}=fa(e),n=i.reduce((a,c)=>{mt.lastIndex=0;let m=mt.exec(c),f=mt.exec(c),u=m[1]!==void 0?m[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):m[0];if(u==="*"&&(u=Ae),f===null)return a[u]=null,a;if(a[u]===null)return a;let{index:g}=f,d=`${c.substr(g,c.length-1)}`;return a[u]=a[u]||[],u!==Ae&&a[u].length===0&&a[u].push(...a[Ae]||[]),u===Ae&&Object.keys(a).forEach(function(l){a[l]&&a[l].push(d)}),a[u].push(d),a},{}),o={[ca]:gt({paths:i,censor:r,serialize:t,strict:Hr})},s=(...a)=>t(typeof r=="function"?r(...a):r);return[...Object.keys(n),...Object.getOwnPropertySymbols(n)].reduce((a,c)=>{if(n[c]===null)a[c]=m=>s(m,[c]);else{let m=typeof r=="function"?(f,u)=>r(f,[c,...u]):r;a[c]=gt({paths:n[c],censor:m,serialize:t,strict:Hr})}return a},o)}function fa(e){if(Array.isArray(e))return e={paths:e,censor:Kr},Vr(e),e;let{paths:t,censor:i=Kr,remove:r}=e;if(Array.isArray(t)===!1)throw Error("pino \u2013 redact must contain an array of strings");return r===!0&&(i=void 0),Vr({paths:t,censor:i}),{paths:t,censor:i}}Xr.exports=la});var Qr=I((Yf,Yr)=>{"use strict";var da=()=>"",ma=()=>`,"time":${Date.now()}`,ga=()=>`,"time":${Math.round(Date.now()/1e3)}`,pa=()=>`,"time":"${new Date(Date.now()).toISOString()}"`;Yr.exports={nullTime:da,epochTime:ma,unixTime:ga,isoTime:pa}});var ei=I((Qf,Zr)=>{"use strict";function ha(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}Zr.exports=ya;function ya(e,t,i){var r=i&&i.stringify||ha,n=1;if(typeof e=="object"&&e!==null){var o=t.length+n;if(o===1)return e;var s=new Array(o);s[0]=r(e);for(var a=1;a<o;a++)s[a]=r(t[a]);return s.join(" ")}if(typeof e!="string")return e;var c=t.length;if(c===0)return e;for(var m="",f=1-n,u=-1,g=e&&e.length||0,d=0;d<g;){if(e.charCodeAt(d)===37&&d+1<g){switch(u=u>-1?u:0,e.charCodeAt(d+1)){case 100:case 102:if(f>=c||t[f]==null)break;u<d&&(m+=e.slice(u,d)),m+=Number(t[f]),u=d+2,d++;break;case 105:if(f>=c||t[f]==null)break;u<d&&(m+=e.slice(u,d)),m+=Math.floor(Number(t[f])),u=d+2,d++;break;case 79:case 111:case 106:if(f>=c||t[f]===void 0)break;u<d&&(m+=e.slice(u,d));var l=typeof t[f];if(l==="string"){m+="'"+t[f]+"'",u=d+2,d++;break}if(l==="function"){m+=t[f].name||"<anonymous>",u=d+2,d++;break}m+=r(t[f]),u=d+2,d++;break;case 115:if(f>=c)break;u<d&&(m+=e.slice(u,d)),m+=String(t[f]),u=d+2,d++;break;case 37:u<d&&(m+=e.slice(u,d)),m+="%",u=d+2,d++,f--;break}++f}++d}return u===-1?e:(u<g&&(m+=e.slice(u)),m)}});var yt=I((Zf,ht)=>{"use strict";if(typeof SharedArrayBuffer<"u"&&typeof Atomics<"u"){let t=function(i){if((i>0&&i<1/0)===!1)throw typeof i!="number"&&typeof i!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");Atomics.wait(e,0,0,Number(i))},e=new Int32Array(new SharedArrayBuffer(4));ht.exports=t}else{let e=function(t){if((t>0&&t<1/0)===!1)throw typeof t!="number"&&typeof t!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");let r=Date.now()+Number(t);for(;r>Date.now(););};ht.exports=e}});var ci=I((ed,ai)=>{"use strict";var N=require("fs"),wa=require("events"),ba=require("util").inherits,ti=require("path"),bt=yt(),va=require("assert"),Me=100,_e=Buffer.allocUnsafe(0),Sa=16*1024,ri="buffer",ii="utf8",[xa,Ca]=(process.versions.node||"0.0").split(".").map(Number),ka=xa>=22&&Ca>=7;function oi(e,t){t._opening=!0,t._writing=!0,t._asyncDrainScheduled=!1;function i(o,s){if(o){t._reopening=!1,t._writing=!1,t._opening=!1,t.sync?process.nextTick(()=>{t.listenerCount("error")>0&&t.emit("error",o)}):t.emit("error",o);return}let a=t._reopening;t.fd=s,t.file=e,t._reopening=!1,t._opening=!1,t._writing=!1,t.sync?process.nextTick(()=>t.emit("ready")):t.emit("ready"),!t.destroyed&&(!t._writing&&t._len>t.minLength||t._flushPending?t._actualWrite():a&&process.nextTick(()=>t.emit("drain")))}let r=t.append?"a":"w",n=t.mode;if(t.sync)try{t.mkdir&&N.mkdirSync(ti.dirname(e),{recursive:!0});let o=N.openSync(e,r,n);i(null,o)}catch(o){throw i(o),o}else t.mkdir?N.mkdir(ti.dirname(e),{recursive:!0},o=>{if(o)return i(o);N.open(e,r,n,i)}):N.open(e,r,n,i)}function W(e){if(!(this instanceof W))return new W(e);let{fd:t,dest:i,minLength:r,maxLength:n,maxWrite:o,periodicFlush:s,sync:a,append:c=!0,mkdir:m,retryEAGAIN:f,fsync:u,contentMode:g,mode:d}=e||{};t=t||i,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(r||0,16387),this.file=null,this.destroyed=!1,this.minLength=r||0,this.maxLength=n||0,this.maxWrite=o||Sa,this._periodicFlush=s||0,this._periodicFlushTimer=void 0,this.sync=a||!1,this.writable=!0,this._fsync=u||!1,this.append=c||!1,this.mode=d,this.retryEAGAIN=f||(()=>!0),this.mkdir=m||!1;let l,h;if(g===ri)this._writingBuf=_e,this.write=Ia,this.flush=Aa,this.flushSync=_a,this._actualWrite=Ba,l=()=>N.writeSync(this.fd,this._writingBuf),h=()=>N.write(this.fd,this._writingBuf,this.release);else if(g===void 0||g===ii)this._writingBuf="",this.write=$a,this.flush=Oa,this.flushSync=Ma,this._actualWrite=Ra,l=()=>N.writeSync(this.fd,this._writingBuf,"utf8"),h=()=>N.write(this.fd,this._writingBuf,"utf8",this.release);else throw new Error(`SonicBoom supports "${ii}" and "${ri}", but passed ${g}`);if(typeof t=="number")this.fd=t,process.nextTick(()=>this.emit("ready"));else if(typeof t=="string")oi(t,this);else throw new Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw new Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(w,v)=>{if(w){if((w.code==="EAGAIN"||w.code==="EBUSY")&&this.retryEAGAIN(w,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{bt(Me),this.release(void 0,0)}catch(x){this.release(x)}else setTimeout(h,Me);else this._writing=!1,this.emit("error",w);return}this.emit("write",v);let b=wt(this._writingBuf,this._len,v);if(this._len=b.len,this._writingBuf=b.writingBuf,this._writingBuf.length){if(!this.sync){h();return}try{do{let x=l(),E=wt(this._writingBuf,this._len,x);this._len=E.len,this._writingBuf=E.writingBuf}while(this._writingBuf.length)}catch(x){this.release(x);return}}this._fsync&&N.fsyncSync(this.fd);let S=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):S>this.minLength?this._actualWrite():this._ending?S>0?this._actualWrite():(this._writing=!1,Re(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(Ea,this)):this.emit("drain"))},this.on("newListener",function(w){w==="drain"&&(this._asyncDrainScheduled=!1)}),this._periodicFlush!==0&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function wt(e,t,i){return typeof e=="string"&&Buffer.byteLength(e)!==i&&(i=Buffer.from(e).subarray(0,i).toString().length),t=Math.max(t-i,0),e=e.slice(i),{writingBuf:e,len:t}}function Ea(e){e.listenerCount("drain")>0&&(e._asyncDrainScheduled=!1,e.emit("drain"))}ba(W,wa);function ni(e,t){return e.length===0?_e:e.length===1?e[0]:Buffer.concat(e,t)}function $a(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,i=this._bufs;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(i.length===0||i[i.length-1].length+e.length>this.maxWrite?i.push(""+e):i[i.length-1]+=e,this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function Ia(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,i=this._bufs,r=this._lens;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(i.length===0||r[r.length-1]+e.length>this.maxWrite?(i.push([e]),r.push(e.length)):(i[i.length-1].push(e),r[r.length-1]+=e.length),this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function si(e){this._flushPending=!0;let t=()=>{if(this._fsync)this._flushPending=!1,e();else try{N.fsync(this.fd,r=>{this._flushPending=!1,e(r)})}catch(r){e(r)}this.off("error",i)},i=r=>{this._flushPending=!1,e(r),this.off("drain",t)};this.once("drain",t),this.once("error",i)}function Oa(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&si.call(this,e),!this._writing&&(this._bufs.length===0&&this._bufs.push(""),this._actualWrite())}function Aa(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&si.call(this,e),!this._writing&&(this._bufs.length===0&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite())}W.prototype.reopen=function(e){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.reopen(e)});return}if(this._ending)return;if(!this.file)throw new Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(e&&(this.file=e),this._reopening=!0,this._writing)return;let t=this.fd;this.once("ready",()=>{t!==this.fd&&N.close(t,i=>{if(i)return this.emit("error",i)})}),oi(this.file,this)};W.prototype.end=function(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.end()});return}this._ending||(this._ending=!0,!this._writing&&(this._len>0&&this.fd>=0?this._actualWrite():Re(this)))};function Ma(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let e="";for(;this._bufs.length||e;){e.length<=0&&(e=this._bufs[0]);try{let t=N.writeSync(this.fd,e,"utf8"),i=wt(e,this._len,t);e=i.writingBuf,this._len=i.len,e.length<=0&&this._bufs.shift()}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;bt(Me)}}try{N.fsyncSync(this.fd)}catch{}}function _a(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=_e);let e=_e;for(;this._bufs.length||e.length;){e.length<=0&&(e=ni(this._bufs[0],this._lens[0]));try{let t=N.writeSync(this.fd,e);e=e.subarray(t),this._len=Math.max(this._len-t,0),e.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;bt(Me)}}}W.prototype.destroy=function(){this.destroyed||Re(this)};function Ra(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let t=N.writeSync(this.fd,this._writingBuf,"utf8");e(null,t)}catch(t){e(t)}else N.write(this.fd,this._writingBuf,"utf8",e)}function Ba(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:ni(this._bufs.shift(),this._lens.shift()),this.sync)try{let t=N.writeSync(this.fd,this._writingBuf);e(null,t)}catch(t){e(t)}else ka&&(this._writingBuf=Buffer.from(this._writingBuf)),N.write(this.fd,this._writingBuf,e)}function Re(e){if(e.fd===-1){e.once("ready",Re.bind(null,e));return}e._periodicFlushTimer!==void 0&&clearInterval(e._periodicFlushTimer),e.destroyed=!0,e._bufs=[],e._lens=[],va(typeof e.fd=="number",`sonic.fd must be a number, got ${typeof e.fd}`);try{N.fsync(e.fd,t)}catch{}function t(){e.fd!==1&&e.fd!==2?N.close(e.fd,i):i()}function i(r){if(r){e.emit("error",r);return}e._ending&&!e._writing&&e.emit("finish"),e.emit("close")}}W.SonicBoom=W;W.default=W;ai.exports=W});var vt=I((td,mi)=>{"use strict";var F={exit:[],beforeExit:[]},ui={exit:Ta,beforeExit:Ga},ce;function Na(){ce===void 0&&(ce=new FinalizationRegistry(Ua))}function Pa(e){F[e].length>0||process.on(e,ui[e])}function li(e){F[e].length>0||(process.removeListener(e,ui[e]),F.exit.length===0&&F.beforeExit.length===0&&(ce=void 0))}function Ta(){fi("exit")}function Ga(){fi("beforeExit")}function fi(e){for(let t of F[e]){let i=t.deref(),r=t.fn;i!==void 0&&r(i,e)}F[e]=[]}function Ua(e){for(let t of["exit","beforeExit"]){let i=F[t].indexOf(e);F[t].splice(i,i+1),li(t)}}function di(e,t,i){if(t===void 0)throw new Error("the object can't be undefined");Pa(e);let r=new WeakRef(t);r.fn=i,Na(),ce.register(t,r),F[e].push(r)}function qa(e,t){di("exit",e,t)}function ja(e,t){di("beforeExit",e,t)}function Da(e){if(ce!==void 0){ce.unregister(e);for(let t of["exit","beforeExit"])F[t]=F[t].filter(i=>{let r=i.deref();return r&&r!==e}),li(t)}}mi.exports={register:qa,registerBeforeExit:ja,unregister:Da}});var gi=I((rd,La)=>{La.exports={name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"}});var hi=I((id,pi)=>{"use strict";function Ja(e,t,i,r,n){let o=Date.now()+r,s=Atomics.load(e,t);if(s===i){n(null,"ok");return}let a=s,c=m=>{Date.now()>o?n(null,"timed-out"):setTimeout(()=>{a=s,s=Atomics.load(e,t),s===a?c(m>=1e3?1e3:m*2):s===i?n(null,"ok"):n(null,"not-equal")},m)};c(1)}function za(e,t,i,r,n){let o=Date.now()+r,s=Atomics.load(e,t);if(s!==i){n(null,"ok");return}let a=c=>{Date.now()>o?n(null,"timed-out"):setTimeout(()=>{s=Atomics.load(e,t),s!==i?n(null,"ok"):a(c>=1e3?1e3:c*2)},c)};a(1)}pi.exports={wait:Ja,waitDiff:za}});var wi=I((od,yi)=>{"use strict";yi.exports={WRITE_INDEX:4,READ_INDEX:8}});var Ci=I((nd,xi)=>{"use strict";var{version:Wa}=gi(),{EventEmitter:Fa}=require("events"),{Worker:Va}=require("worker_threads"),{join:Ka}=require("path"),{pathToFileURL:Ha}=require("url"),{wait:Xa}=hi(),{WRITE_INDEX:j,READ_INDEX:V}=wi(),Ya=require("buffer"),Qa=require("assert"),p=Symbol("kImpl"),Za=Ya.constants.MAX_STRING_LENGTH,we=class{constructor(t){this._value=t}deref(){return this._value}},Ne=class{register(){}unregister(){}},ec=process.env.NODE_V8_COVERAGE?Ne:global.FinalizationRegistry||Ne,tc=process.env.NODE_V8_COVERAGE?we:global.WeakRef||we,bi=new ec(e=>{e.exited||e.terminate()});function rc(e,t){let{filename:i,workerData:r}=t,o=("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||Ka(__dirname,"lib","worker.js"),s=new Va(o,{...t.workerOpts,trackUnmanagedFds:!1,workerData:{filename:i.indexOf("file://")===0?i:Ha(i).href,dataBuf:e[p].dataBuf,stateBuf:e[p].stateBuf,workerData:{$context:{threadStreamVersion:Wa},...r}}});return s.stream=new we(e),s.on("message",ic),s.on("exit",Si),bi.register(e,s),s}function vi(e){Qa(!e[p].sync),e[p].needDrain&&(e[p].needDrain=!1,e.emit("drain"))}function Be(e){let t=Atomics.load(e[p].state,j),i=e[p].data.length-t;if(i>0){if(e[p].buf.length===0){e[p].flushing=!1,e[p].ending?Et(e):e[p].needDrain&&process.nextTick(vi,e);return}let r=e[p].buf.slice(0,i),n=Buffer.byteLength(r);n<=i?(e[p].buf=e[p].buf.slice(i),Pe(e,r,Be.bind(null,e))):e.flush(()=>{if(!e.destroyed){for(Atomics.store(e[p].state,V,0),Atomics.store(e[p].state,j,0);n>e[p].data.length;)i=i/2,r=e[p].buf.slice(0,i),n=Buffer.byteLength(r);e[p].buf=e[p].buf.slice(i),Pe(e,r,Be.bind(null,e))}})}else if(i===0){if(t===0&&e[p].buf.length===0)return;e.flush(()=>{Atomics.store(e[p].state,V,0),Atomics.store(e[p].state,j,0),Be(e)})}else K(e,new Error("overwritten"))}function ic(e){let t=this.stream.deref();if(t===void 0){this.exited=!0,this.terminate();return}switch(e.code){case"READY":this.stream=new tc(t),t.flush(()=>{t[p].ready=!0,t.emit("ready")});break;case"ERROR":K(t,e.err);break;case"EVENT":Array.isArray(e.args)?t.emit(e.name,...e.args):t.emit(e.name,e.args);break;case"WARNING":process.emitWarning(e.err);break;default:K(t,new Error("this should not happen: "+e.code))}}function Si(e){let t=this.stream.deref();t!==void 0&&(bi.unregister(t),t.worker.exited=!0,t.worker.off("exit",Si),K(t,e!==0?new Error("the worker thread exited"):null))}var xt=class extends Fa{constructor(t={}){if(super(),t.bufferSize<4)throw new Error("bufferSize must at least fit a 4-byte utf-8 char");this[p]={},this[p].stateBuf=new SharedArrayBuffer(128),this[p].state=new Int32Array(this[p].stateBuf),this[p].dataBuf=new SharedArrayBuffer(t.bufferSize||4*1024*1024),this[p].data=Buffer.from(this[p].dataBuf),this[p].sync=t.sync||!1,this[p].ending=!1,this[p].ended=!1,this[p].needDrain=!1,this[p].destroyed=!1,this[p].flushing=!1,this[p].ready=!1,this[p].finished=!1,this[p].errored=null,this[p].closed=!1,this[p].buf="",this.worker=rc(this,t),this.on("message",(i,r)=>{this.worker.postMessage(i,r)})}write(t){if(this[p].destroyed)return Ct(this,new Error("the worker has exited")),!1;if(this[p].ending)return Ct(this,new Error("the worker is ending")),!1;if(this[p].flushing&&this[p].buf.length+t.length>=Za)try{St(this),this[p].flushing=!0}catch(i){return K(this,i),!1}if(this[p].buf+=t,this[p].sync)try{return St(this),!0}catch(i){return K(this,i),!1}return this[p].flushing||(this[p].flushing=!0,setImmediate(Be,this)),this[p].needDrain=this[p].data.length-this[p].buf.length-Atomics.load(this[p].state,j)<=0,!this[p].needDrain}end(){this[p].destroyed||(this[p].ending=!0,Et(this))}flush(t){if(this[p].destroyed){typeof t=="function"&&process.nextTick(t,new Error("the worker has exited"));return}let i=Atomics.load(this[p].state,j);Xa(this[p].state,V,i,1/0,(r,n)=>{if(r){K(this,r),process.nextTick(t,r);return}if(n==="not-equal"){this.flush(t);return}process.nextTick(t)})}flushSync(){this[p].destroyed||(St(this),kt(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[p].ready}get destroyed(){return this[p].destroyed}get closed(){return this[p].closed}get writable(){return!this[p].destroyed&&!this[p].ending}get writableEnded(){return this[p].ending}get writableFinished(){return this[p].finished}get writableNeedDrain(){return this[p].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[p].errored}};function Ct(e,t){setImmediate(()=>{e.emit("error",t)})}function K(e,t){e[p].destroyed||(e[p].destroyed=!0,t&&(e[p].errored=t,Ct(e,t)),e.worker.exited?setImmediate(()=>{e[p].closed=!0,e.emit("close")}):e.worker.terminate().catch(()=>{}).then(()=>{e[p].closed=!0,e.emit("close")}))}function Pe(e,t,i){let r=Atomics.load(e[p].state,j),n=Buffer.byteLength(t);return e[p].data.write(t,r),Atomics.store(e[p].state,j,r+n),Atomics.notify(e[p].state,j),i(),!0}function Et(e){if(!(e[p].ended||!e[p].ending||e[p].flushing)){e[p].ended=!0;try{e.flushSync();let t=Atomics.load(e[p].state,V);Atomics.store(e[p].state,j,-1),Atomics.notify(e[p].state,j);let i=0;for(;t!==-1;){if(Atomics.wait(e[p].state,V,t,1e3),t=Atomics.load(e[p].state,V),t===-2){K(e,new Error("end() failed"));return}if(++i===10){K(e,new Error("end() took too long (10s)"));return}}process.nextTick(()=>{e[p].finished=!0,e.emit("finish")})}catch(t){K(e,t)}}}function St(e){let t=()=>{e[p].ending?Et(e):e[p].needDrain&&process.nextTick(vi,e)};for(e[p].flushing=!1;e[p].buf.length!==0;){let i=Atomics.load(e[p].state,j),r=e[p].data.length-i;if(r===0){kt(e),Atomics.store(e[p].state,V,0),Atomics.store(e[p].state,j,0);continue}else if(r<0)throw new Error("overwritten");let n=e[p].buf.slice(0,r),o=Buffer.byteLength(n);if(o<=r)e[p].buf=e[p].buf.slice(r),Pe(e,n,t);else{for(kt(e),Atomics.store(e[p].state,V,0),Atomics.store(e[p].state,j,0);o>e[p].buf.length;)r=r/2,n=e[p].buf.slice(0,r),o=Buffer.byteLength(n);e[p].buf=e[p].buf.slice(r),Pe(e,n,t)}}}function kt(e){if(e[p].flushing)throw new Error("unable to flush while flushing");let t=Atomics.load(e[p].state,j),i=0;for(;;){let r=Atomics.load(e[p].state,V);if(r===-2)throw Error("_flushSync failed");if(r!==t)Atomics.wait(e[p].state,V,r,1e3);else break;if(++i===10)throw new Error("_flushSync took too long (10s)")}}xi.exports=xt});var Ot=I((sd,ki)=>{"use strict";var{createRequire:oc}=require("module"),nc=ct(),{join:$t,isAbsolute:sc,sep:ac}=require("path"),cc=yt(),It=vt(),uc=Ci();function lc(e){It.register(e,dc),It.registerBeforeExit(e,mc),e.on("close",function(){It.unregister(e)})}function fc(e,t,i,r){let n=new uc({filename:e,workerData:t,workerOpts:i,sync:r});n.on("ready",o),n.on("close",function(){process.removeListener("exit",s)}),process.on("exit",s);function o(){process.removeListener("exit",s),n.unref(),i.autoEnd!==!1&&lc(n)}function s(){n.closed||(n.flushSync(),cc(100),n.end())}return n}function dc(e){e.ref(),e.flushSync(),e.end(),e.once("close",function(){e.unref()})}function mc(e){e.flushSync()}function gc(e){let{pipeline:t,targets:i,levels:r,dedupe:n,worker:o={},caller:s=nc(),sync:a=!1}=e,c={...e.options},m=typeof s=="string"?[s]:s,f="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},u=e.target;if(u&&i)throw new Error("only one of target or targets can be specified");return i?(u=f["pino-worker"]||$t(__dirname,"worker.js"),c.targets=i.filter(d=>d.target).map(d=>({...d,target:g(d.target)})),c.pipelines=i.filter(d=>d.pipeline).map(d=>d.pipeline.map(l=>({...l,level:d.level,target:g(l.target)})))):t&&(u=f["pino-worker"]||$t(__dirname,"worker.js"),c.pipelines=[t.map(d=>({...d,target:g(d.target)}))]),r&&(c.levels=r),n&&(c.dedupe=n),c.pinoWillSendConfig=!0,fc(g(u),c,o,a);function g(d){if(d=f[d]||d,sc(d)||d.indexOf("file://")===0)return d;if(d==="pino/file")return $t(__dirname,"..","file.js");let l;for(let h of m)try{let w=h==="node:repl"?process.cwd()+ac:h;l=oc(w).resolve(d);break}catch{continue}if(!l)throw new Error(`unable to determine transport target for "${d}"`);return l}}ki.exports=gc});var Ue=I((ad,Pi)=>{"use strict";var Ei=ei(),{mapHttpRequest:pc,mapHttpResponse:hc}=at(),Mt=ci(),$i=vt(),{lsCacheSym:yc,chindingsSym:Ai,writeSym:Ii,serializersSym:Mi,formatOptsSym:Oi,endSym:wc,stringifiersSym:_i,stringifySym:Ri,stringifySafeSym:_t,wildcardFirstSym:Bi,nestedKeySym:bc,formattersSym:Ni,messageKeySym:vc,errorKeySym:Sc,nestedKeyStrSym:xc,msgPrefixSym:Te}=ae(),{isMainThread:Cc}=require("worker_threads"),kc=Ot();function ue(){}function Ec(e,t){if(!t)return i;return function(...n){t.call(this,n,i,e)};function i(r,...n){if(typeof r=="object"){let o=r;r!==null&&(r.method&&r.headers&&r.socket?r=pc(r):typeof r.setHeader=="function"&&(r=hc(r)));let s;o===null&&n.length===0?s=[null]:(o=n.shift(),s=n),typeof this[Te]=="string"&&o!==void 0&&o!==null&&(o=this[Te]+o),this[Ii](r,Ei(o,s,this[Oi]),e)}else{let o=r===void 0?n.shift():r;typeof this[Te]=="string"&&o!==void 0&&o!==null&&(o=this[Te]+o),this[Ii](null,Ei(o,n,this[Oi]),e)}}}function At(e){let t="",i=0,r=!1,n=255,o=e.length;if(o>100)return JSON.stringify(e);for(var s=0;s<o&&n>=32;s++)n=e.charCodeAt(s),(n===34||n===92)&&(t+=e.slice(i,s)+"\\",i=s,r=!0);return r?t+=e.slice(i):t=e,n<32?JSON.stringify(e):'"'+t+'"'}function $c(e,t,i,r){let n=this[Ri],o=this[_t],s=this[_i],a=this[wc],c=this[Ai],m=this[Mi],f=this[Ni],u=this[vc],g=this[Sc],d=this[yc][i]+r;d=d+c;let l;f.log&&(e=f.log(e));let h=s[Bi],w="";for(let b in e)if(l=e[b],Object.prototype.hasOwnProperty.call(e,b)&&l!==void 0){m[b]?l=m[b](l):b===g&&m.err&&(l=m.err(l));let S=s[b]||h;switch(typeof l){case"undefined":case"function":continue;case"number":Number.isFinite(l)===!1&&(l=null);case"boolean":S&&(l=S(l));break;case"string":l=(S||At)(l);break;default:l=(S||n)(l,o)}if(l===void 0)continue;let x=At(b);w+=","+x+":"+l}let v="";if(t!==void 0){l=m[u]?m[u](t):t;let b=s[u]||h;switch(typeof l){case"function":break;case"number":Number.isFinite(l)===!1&&(l=null);case"boolean":b&&(l=b(l)),v=',"'+u+'":'+l;break;case"string":l=(b||At)(l),v=',"'+u+'":'+l;break;default:l=(b||n)(l,o),v=',"'+u+'":'+l}}return this[bc]&&w?d+this[xc]+w.slice(1)+"}"+v+a:d+w+v+a}function Ic(e,t){let i,r=e[Ai],n=e[Ri],o=e[_t],s=e[_i],a=s[Bi],c=e[Mi],m=e[Ni].bindings;t=m(t);for(let f in t)if(i=t[f],(f!=="level"&&f!=="serializers"&&f!=="formatters"&&f!=="customLevels"&&t.hasOwnProperty(f)&&i!==void 0)===!0){if(i=c[f]?c[f](i):i,i=(s[f]||a||n)(i,o),i===void 0)continue;r+=',"'+f+'":'+i}return r}function Oc(e){return e.write!==e.constructor.prototype.write}var Ac=process.env.NODE_V8_COVERAGE||process.env.V8_COVERAGE;function Ge(e){let t=new Mt(e);return t.on("error",i),!Ac&&!e.sync&&Cc&&($i.register(t,Mc),t.on("close",function(){$i.unregister(t)})),t;function i(r){if(r.code==="EPIPE"){t.write=ue,t.end=ue,t.flushSync=ue,t.destroy=ue;return}t.removeListener("error",i),t.emit("error",r)}}function Mc(e,t){e.destroyed||(t==="beforeExit"?(e.flush(),e.on("drain",function(){e.end()})):e.flushSync())}function _c(e){return function(i,r,n={},o){if(typeof n=="string")o=Ge({dest:n}),n={};else if(typeof o=="string"){if(n&&n.transport)throw Error("only one of option.transport or stream can be specified");o=Ge({dest:o})}else if(n instanceof Mt||n.writable||n._writableState)o=n,n={};else if(n.transport){if(n.transport instanceof Mt||n.transport.writable||n.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(n.transport.targets&&n.transport.targets.length&&n.formatters&&typeof n.formatters.level=="function")throw Error("option.transport.targets do not allow custom level formatters");let c;n.customLevels&&(c=n.useOnlyCustomLevels?n.customLevels:Object.assign({},n.levels,n.customLevels)),o=kc({caller:r,...n.transport,levels:c})}if(n=Object.assign({},e,n),n.serializers=Object.assign({},e.serializers,n.serializers),n.formatters=Object.assign({},e.formatters,n.formatters),n.prettyPrint)throw new Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:s,onChild:a}=n;return s===!1&&(n.level="silent"),a||(n.onChild=ue),o||(Oc(process.stdout)?o=process.stdout:o=Ge({fd:process.stdout.fd||1})),{opts:n,stream:o}}}function Rc(e,t){try{return JSON.stringify(e)}catch{try{return(t||this[_t])(e)}catch{return'"[unable to serialize, circular reference is too complex to analyze]"'}}}function Bc(e,t,i){return{level:e,bindings:t,log:i}}function Nc(e){let t=Number(e);return typeof e=="string"&&Number.isFinite(t)?t:e===void 0?1:e}Pi.exports={noop:ue,buildSafeSonicBoom:Ge,asChindings:Ic,asJson:$c,genLog:Ec,createArgsNormalizer:_c,stringify:Rc,buildFormatters:Bc,normalizeDestFileDescriptor:Nc}});var qe=I((cd,Ti)=>{var Pc={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},Tc={ASC:"ASC",DESC:"DESC"};Ti.exports={DEFAULT_LEVELS:Pc,SORTING_ORDER:Tc}});var Nt=I((ud,ji)=>{"use strict";var{lsCacheSym:Gc,levelValSym:Rt,useOnlyCustomLevelsSym:Uc,streamSym:qc,formattersSym:jc,hooksSym:Dc,levelCompSym:Gi}=ae(),{noop:Lc,genLog:re}=Ue(),{DEFAULT_LEVELS:H,SORTING_ORDER:Ui}=qe(),qi={fatal:e=>{let t=re(H.fatal,e);return function(...i){let r=this[qc];if(t.call(this,...i),typeof r.flushSync=="function")try{r.flushSync()}catch{}}},error:e=>re(H.error,e),warn:e=>re(H.warn,e),info:e=>re(H.info,e),debug:e=>re(H.debug,e),trace:e=>re(H.trace,e)},Bt=Object.keys(H).reduce((e,t)=>(e[H[t]]=t,e),{}),Jc=Object.keys(Bt).reduce((e,t)=>(e[t]='{"level":'+Number(t),e),{});function zc(e){let t=e[jc].level,{labels:i}=e.levels,r={};for(let n in i){let o=t(i[n],Number(n));r[n]=JSON.stringify(o).slice(0,-1)}return e[Gc]=r,e}function Wc(e,t){if(t)return!1;switch(e){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}function Fc(e){let{labels:t,values:i}=this.levels;if(typeof e=="number"){if(t[e]===void 0)throw Error("unknown level value"+e);e=t[e]}if(i[e]===void 0)throw Error("unknown level "+e);let r=this[Rt],n=this[Rt]=i[e],o=this[Uc],s=this[Gi],a=this[Dc].logMethod;for(let c in i){if(s(i[c],n)===!1){this[c]=Lc;continue}this[c]=Wc(c,o)?qi[c](a):re(i[c],a)}this.emit("level-change",e,n,t[r],r,this)}function Vc(e){let{levels:t,levelVal:i}=this;return t&&t.labels?t.labels[i]:""}function Kc(e){let{values:t}=this.levels,i=t[e];return i!==void 0&&this[Gi](i,this[Rt])}function Hc(e,t,i){return e===Ui.DESC?t<=i:t>=i}function Xc(e){return typeof e=="string"?Hc.bind(null,e):e}function Yc(e=null,t=!1){let i=e?Object.keys(e).reduce((o,s)=>(o[e[s]]=s,o),{}):null,r=Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),t?null:Bt,i),n=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),t?null:H,e);return{labels:r,values:n}}function Qc(e,t,i){if(typeof e=="number"){if(![].concat(Object.keys(t||{}).map(o=>t[o]),i?[]:Object.keys(Bt).map(o=>+o),1/0).includes(e))throw Error(`default level:${e} must be included in custom levels`);return}let r=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),i?null:H,t);if(!(e in r))throw Error(`default level:${e} must be included in custom levels`)}function Zc(e,t){let{labels:i,values:r}=e;for(let n in t){if(n in r)throw Error("levels cannot be overridden");if(t[n]in i)throw Error("pre-existing level values cannot be used for new levels")}}function eu(e){if(typeof e!="function"&&!(typeof e=="string"&&Object.values(Ui).includes(e)))throw new Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}ji.exports={initialLsCache:Jc,genLsCache:zc,levelMethods:qi,getLevel:Vc,setLevel:Fc,isLevelEnabled:Kc,mappings:Yc,assertNoLevelCollisions:Zc,assertDefaultLevelFound:Qc,genLevelComparison:Xc,assertLevelComparison:eu}});var Pt=I((ld,Di)=>{"use strict";Di.exports={version:"9.6.0"}});var Qi=I((dd,Yi)=>{"use strict";var{EventEmitter:tu}=require("events"),{lsCacheSym:ru,levelValSym:iu,setLevelSym:Gt,getLevelSym:Li,chindingsSym:Ut,parsedChindingsSym:ou,mixinSym:nu,asJsonSym:Vi,writeSym:su,mixinMergeStrategySym:au,timeSym:cu,timeSliceIndexSym:uu,streamSym:Ki,serializersSym:ie,formattersSym:Tt,errorKeySym:lu,messageKeySym:fu,useOnlyCustomLevelsSym:du,needsMetadataGsym:mu,redactFmtSym:gu,stringifySym:pu,formatOptsSym:hu,stringifiersSym:yu,msgPrefixSym:Ji,hooksSym:wu}=ae(),{getLevel:bu,setLevel:vu,isLevelEnabled:Su,mappings:xu,initialLsCache:Cu,genLsCache:ku,assertNoLevelCollisions:Eu}=Nt(),{asChindings:Hi,asJson:$u,buildFormatters:zi,stringify:Wi}=Ue(),{version:Iu}=Pt(),Ou=pt(),Au=class{},Xi={constructor:Au,child:Mu,bindings:_u,setBindings:Ru,flush:Tu,isLevelEnabled:Su,version:Iu,get level(){return this[Li]()},set level(e){this[Gt](e)},get levelVal(){return this[iu]},set levelVal(e){throw Error("levelVal is read-only")},[ru]:Cu,[su]:Nu,[Vi]:$u,[Li]:bu,[Gt]:vu};Object.setPrototypeOf(Xi,tu.prototype);Yi.exports=function(){return Object.create(Xi)};var Fi=e=>e;function Mu(e,t){if(!e)throw Error("missing bindings for child Pino");t=t||{};let i=this[ie],r=this[Tt],n=Object.create(this);if(t.hasOwnProperty("serializers")===!0){n[ie]=Object.create(null);for(let f in i)n[ie][f]=i[f];let c=Object.getOwnPropertySymbols(i);for(var o=0;o<c.length;o++){let f=c[o];n[ie][f]=i[f]}for(let f in t.serializers)n[ie][f]=t.serializers[f];let m=Object.getOwnPropertySymbols(t.serializers);for(var s=0;s<m.length;s++){let f=m[s];n[ie][f]=t.serializers[f]}}else n[ie]=i;if(t.hasOwnProperty("formatters")){let{level:c,bindings:m,log:f}=t.formatters;n[Tt]=zi(c||r.level,m||Fi,f||r.log)}else n[Tt]=zi(r.level,Fi,r.log);if(t.hasOwnProperty("customLevels")===!0&&(Eu(this.levels,t.customLevels),n.levels=xu(t.customLevels,n[du]),ku(n)),typeof t.redact=="object"&&t.redact!==null||Array.isArray(t.redact)){n.redact=t.redact;let c=Ou(n.redact,Wi),m={stringify:c[gu]};n[pu]=Wi,n[yu]=c,n[hu]=m}typeof t.msgPrefix=="string"&&(n[Ji]=(this[Ji]||"")+t.msgPrefix),n[Ut]=Hi(n,e);let a=t.level||this.level;return n[Gt](a),this.onChild(n),n}function _u(){let t=`{${this[Ut].substr(1)}}`,i=JSON.parse(t);return delete i.pid,delete i.hostname,i}function Ru(e){let t=Hi(this,e);this[Ut]=t,delete this[ou]}function Bu(e,t){return Object.assign(t,e)}function Nu(e,t,i){let r=this[cu](),n=this[nu],o=this[lu],s=this[fu],a=this[au]||Bu,c,m=this[wu].streamWrite;e==null?c={}:e instanceof Error?(c={[o]:e},t===void 0&&(t=e.message)):(c=e,t===void 0&&e[s]===void 0&&e[o]&&(t=e[o].message)),n&&(c=a(c,n(c,i,this)));let f=this[Vi](c,t,i,r),u=this[Ki];u[mu]===!0&&(u.lastLevel=i,u.lastObj=c,u.lastMsg=t,u.lastTime=r.slice(this[uu]),u.lastLogger=this),u.write(m?m(f):f)}function Pu(){}function Tu(e){if(e!=null&&typeof e!="function")throw Error("callback must be a function");let t=this[Ki];typeof t.flush=="function"?t.flush(e||Pu):e&&e()}});var ro=I((Lt,to)=>{"use strict";var{hasOwnProperty:be}=Object.prototype,ne=Dt();ne.configure=Dt;ne.stringify=ne;ne.default=ne;Lt.stringify=ne;Lt.configure=Dt;to.exports=ne;var Gu=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function Y(e){return e.length<5e3&&!Gu.test(e)?`"${e}"`:JSON.stringify(e)}function qt(e,t){if(e.length>200||t)return e.sort(t);for(let i=1;i<e.length;i++){let r=e[i],n=i;for(;n!==0&&e[n-1]>r;)e[n]=e[n-1],n--;e[n]=r}return e}var Uu=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function jt(e){return Uu.call(e)!==void 0&&e.length!==0}function Zi(e,t,i){e.length<i&&(i=e.length);let r=t===","?"":" ",n=`"0":${r}${e[0]}`;for(let o=1;o<i;o++)n+=`${t}"${o}":${r}${e[o]}`;return n}function qu(e){if(be.call(e,"circularValue")){let t=e.circularValue;if(typeof t=="string")return`"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function ju(e){let t;if(be.call(e,"deterministic")&&(t=e.deterministic,typeof t!="boolean"&&typeof t!="function"))throw new TypeError('The "deterministic" argument must be of type boolean or comparator function');return t===void 0?!0:t}function Du(e,t){let i;if(be.call(e,t)&&(i=e[t],typeof i!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return i===void 0?!0:i}function eo(e,t){let i;if(be.call(e,t)){if(i=e[t],typeof i!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(i))throw new TypeError(`The "${t}" argument must be an integer`);if(i<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return i===void 0?1/0:i}function oe(e){return e===1?"1 item":`${e} items`}function Lu(e){let t=new Set;for(let i of e)(typeof i=="string"||typeof i=="number")&&t.add(String(i));return t}function Ju(e){if(be.call(e,"strict")){let t=e.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return i=>{let r=`Object can not safely be stringified. Received type ${typeof i}`;throw typeof i!="function"&&(r+=` (${i.toString()})`),new Error(r)}}}function Dt(e){e={...e};let t=Ju(e);t&&(e.bigint===void 0&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));let i=qu(e),r=Du(e,"bigint"),n=ju(e),o=typeof n=="function"?n:void 0,s=eo(e,"maximumDepth"),a=eo(e,"maximumBreadth");function c(d,l,h,w,v,b){let S=l[d];switch(typeof S=="object"&&S!==null&&typeof S.toJSON=="function"&&(S=S.toJSON(d)),S=w.call(l,d,S),typeof S){case"string":return Y(S);case"object":{if(S===null)return"null";if(h.indexOf(S)!==-1)return i;let x="",E=",",O=b;if(Array.isArray(S)){if(S.length===0)return"[]";if(s<h.length+1)return'"[Array]"';h.push(S),v!==""&&(b+=v,x+=`
${b}`,E=`,
${b}`);let P=Math.min(S.length,a),D=0;for(;D<P-1;D++){let te=c(String(D),S,h,w,v,b);x+=te!==void 0?te:"null",x+=E}let L=c(String(D),S,h,w,v,b);if(x+=L!==void 0?L:"null",S.length-1>a){let te=S.length-a-1;x+=`${E}"... ${oe(te)} not stringified"`}return v!==""&&(x+=`
${O}`),h.pop(),`[${x}]`}let A=Object.keys(S),M=A.length;if(M===0)return"{}";if(s<h.length+1)return'"[Object]"';let C="",R="";v!==""&&(b+=v,E=`,
${b}`,C=" ");let q=Math.min(M,a);n&&!jt(S)&&(A=qt(A,o)),h.push(S);for(let P=0;P<q;P++){let D=A[P],L=c(D,S,h,w,v,b);L!==void 0&&(x+=`${R}${Y(D)}:${C}${L}`,R=E)}if(M>a){let P=M-a;x+=`${R}"...":${C}"${oe(P)} not stringified"`,R=E}return v!==""&&R.length>1&&(x=`
${b}${x}
${O}`),h.pop(),`{${x}}`}case"number":return isFinite(S)?String(S):t?t(S):"null";case"boolean":return S===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(S);default:return t?t(S):void 0}}function m(d,l,h,w,v,b){switch(typeof l=="object"&&l!==null&&typeof l.toJSON=="function"&&(l=l.toJSON(d)),typeof l){case"string":return Y(l);case"object":{if(l===null)return"null";if(h.indexOf(l)!==-1)return i;let S=b,x="",E=",";if(Array.isArray(l)){if(l.length===0)return"[]";if(s<h.length+1)return'"[Array]"';h.push(l),v!==""&&(b+=v,x+=`
${b}`,E=`,
${b}`);let M=Math.min(l.length,a),C=0;for(;C<M-1;C++){let q=m(String(C),l[C],h,w,v,b);x+=q!==void 0?q:"null",x+=E}let R=m(String(C),l[C],h,w,v,b);if(x+=R!==void 0?R:"null",l.length-1>a){let q=l.length-a-1;x+=`${E}"... ${oe(q)} not stringified"`}return v!==""&&(x+=`
${S}`),h.pop(),`[${x}]`}h.push(l);let O="";v!==""&&(b+=v,E=`,
${b}`,O=" ");let A="";for(let M of w){let C=m(M,l[M],h,w,v,b);C!==void 0&&(x+=`${A}${Y(M)}:${O}${C}`,A=E)}return v!==""&&A.length>1&&(x=`
${b}${x}
${S}`),h.pop(),`{${x}}`}case"number":return isFinite(l)?String(l):t?t(l):"null";case"boolean":return l===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(l);default:return t?t(l):void 0}}function f(d,l,h,w,v){switch(typeof l){case"string":return Y(l);case"object":{if(l===null)return"null";if(typeof l.toJSON=="function"){if(l=l.toJSON(d),typeof l!="object")return f(d,l,h,w,v);if(l===null)return"null"}if(h.indexOf(l)!==-1)return i;let b=v;if(Array.isArray(l)){if(l.length===0)return"[]";if(s<h.length+1)return'"[Array]"';h.push(l),v+=w;let C=`
${v}`,R=`,
${v}`,q=Math.min(l.length,a),P=0;for(;P<q-1;P++){let L=f(String(P),l[P],h,w,v);C+=L!==void 0?L:"null",C+=R}let D=f(String(P),l[P],h,w,v);if(C+=D!==void 0?D:"null",l.length-1>a){let L=l.length-a-1;C+=`${R}"... ${oe(L)} not stringified"`}return C+=`
${b}`,h.pop(),`[${C}]`}let S=Object.keys(l),x=S.length;if(x===0)return"{}";if(s<h.length+1)return'"[Object]"';v+=w;let E=`,
${v}`,O="",A="",M=Math.min(x,a);jt(l)&&(O+=Zi(l,E,a),S=S.slice(l.length),M-=l.length,A=E),n&&(S=qt(S,o)),h.push(l);for(let C=0;C<M;C++){let R=S[C],q=f(R,l[R],h,w,v);q!==void 0&&(O+=`${A}${Y(R)}: ${q}`,A=E)}if(x>a){let C=x-a;O+=`${A}"...": "${oe(C)} not stringified"`,A=E}return A!==""&&(O=`
${v}${O}
${b}`),h.pop(),`{${O}}`}case"number":return isFinite(l)?String(l):t?t(l):"null";case"boolean":return l===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(l);default:return t?t(l):void 0}}function u(d,l,h){switch(typeof l){case"string":return Y(l);case"object":{if(l===null)return"null";if(typeof l.toJSON=="function"){if(l=l.toJSON(d),typeof l!="object")return u(d,l,h);if(l===null)return"null"}if(h.indexOf(l)!==-1)return i;let w="",v=l.length!==void 0;if(v&&Array.isArray(l)){if(l.length===0)return"[]";if(s<h.length+1)return'"[Array]"';h.push(l);let O=Math.min(l.length,a),A=0;for(;A<O-1;A++){let C=u(String(A),l[A],h);w+=C!==void 0?C:"null",w+=","}let M=u(String(A),l[A],h);if(w+=M!==void 0?M:"null",l.length-1>a){let C=l.length-a-1;w+=`,"... ${oe(C)} not stringified"`}return h.pop(),`[${w}]`}let b=Object.keys(l),S=b.length;if(S===0)return"{}";if(s<h.length+1)return'"[Object]"';let x="",E=Math.min(S,a);v&&jt(l)&&(w+=Zi(l,",",a),b=b.slice(l.length),E-=l.length,x=","),n&&(b=qt(b,o)),h.push(l);for(let O=0;O<E;O++){let A=b[O],M=u(A,l[A],h);M!==void 0&&(w+=`${x}${Y(A)}:${M}`,x=",")}if(S>a){let O=S-a;w+=`${x}"...":"${oe(O)} not stringified"`}return h.pop(),`{${w}}`}case"number":return isFinite(l)?String(l):t?t(l):"null";case"boolean":return l===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(l);default:return t?t(l):void 0}}function g(d,l,h){if(arguments.length>1){let w="";if(typeof h=="number"?w=" ".repeat(Math.min(h,10)):typeof h=="string"&&(w=h.slice(0,10)),l!=null){if(typeof l=="function")return c("",{"":d},[],l,w,"");if(Array.isArray(l))return m("",d,[],Lu(l),w,"")}if(w.length!==0)return f("",d,[],w,"")}return u("",d,[])}return g}});var no=I((md,oo)=>{"use strict";var Jt=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:io}=qe(),zu=io.info;function Wu(e,t){let i=0;e=e||[],t=t||{dedupe:!1};let r=Object.create(io);r.silent=1/0,t.levels&&typeof t.levels=="object"&&Object.keys(t.levels).forEach(u=>{r[u]=t.levels[u]});let n={write:o,add:c,emit:s,flushSync:a,end:m,minLevel:0,streams:[],clone:f,[Jt]:!0,streamLevels:r};return Array.isArray(e)?e.forEach(c,n):c.call(n,e),e=null,n;function o(u){let g,d=this.lastLevel,{streams:l}=this,h=0,w;for(let v=Vu(l.length,t.dedupe);Hu(v,l.length,t.dedupe);v=Ku(v,t.dedupe))if(g=l[v],g.level<=d){if(h!==0&&h!==g.level)break;if(w=g.stream,w[Jt]){let{lastTime:b,lastMsg:S,lastObj:x,lastLogger:E}=this;w.lastLevel=d,w.lastTime=b,w.lastMsg=S,w.lastObj=x,w.lastLogger=E}w.write(u),t.dedupe&&(h=g.level)}else if(!t.dedupe)break}function s(...u){for(let{stream:g}of this.streams)typeof g.emit=="function"&&g.emit(...u)}function a(){for(let{stream:u}of this.streams)typeof u.flushSync=="function"&&u.flushSync()}function c(u){if(!u)return n;let g=typeof u.write=="function"||u.stream,d=u.write?u:u.stream;if(!g)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:l,streamLevels:h}=this,w;typeof u.levelVal=="number"?w=u.levelVal:typeof u.level=="string"?w=h[u.level]:typeof u.level=="number"?w=u.level:w=zu;let v={stream:d,level:w,levelVal:void 0,id:i++};return l.unshift(v),l.sort(Fu),this.minLevel=l[0].level,n}function m(){for(let{stream:u}of this.streams)typeof u.flushSync=="function"&&u.flushSync(),u.end()}function f(u){let g=new Array(this.streams.length);for(let d=0;d<g.length;d++)g[d]={level:u,stream:this.streams[d].stream};return{write:o,add:c,minLevel:u,streams:g,clone:f,emit:s,flushSync:a,[Jt]:!0}}}function Fu(e,t){return e.level-t.level}function Vu(e,t){return t?e-1:0}function Ku(e,t){return t?e-1:e+1}function Hu(e,t,i){return i?e>=0:e<t}oo.exports=Wu});var vo=I((gd,J)=>{"use strict";var Xu=require("os"),go=at(),Yu=ct(),Qu=pt(),po=Qr(),Zu=Qi(),ho=ae(),{configure:el}=ro(),{assertDefaultLevelFound:tl,mappings:yo,genLsCache:rl,genLevelComparison:il,assertLevelComparison:ol}=Nt(),{DEFAULT_LEVELS:wo,SORTING_ORDER:nl}=qe(),{createArgsNormalizer:sl,asChindings:al,buildSafeSonicBoom:so,buildFormatters:cl,stringify:zt,normalizeDestFileDescriptor:ao,noop:ul}=Ue(),{version:ll}=Pt(),{chindingsSym:co,redactFmtSym:fl,serializersSym:uo,timeSym:dl,timeSliceIndexSym:ml,streamSym:gl,stringifySym:lo,stringifySafeSym:Wt,stringifiersSym:fo,setLevelSym:pl,endSym:hl,formatOptsSym:yl,messageKeySym:wl,errorKeySym:bl,nestedKeySym:vl,mixinSym:Sl,levelCompSym:xl,useOnlyCustomLevelsSym:Cl,formattersSym:mo,hooksSym:kl,nestedKeyStrSym:El,mixinMergeStrategySym:$l,msgPrefixSym:Il}=ho,{epochTime:bo,nullTime:Ol}=po,{pid:Al}=process,Ml=Xu.hostname(),_l=go.err,Rl={level:"info",levelComparison:nl.ASC,levels:wo,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:Al,hostname:Ml},serializers:Object.assign(Object.create(null),{err:_l}),formatters:Object.assign(Object.create(null),{bindings(e){return e},level(e,t){return{level:t}}}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:bo,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100},Bl=sl(Rl),Nl=Object.assign(Object.create(null),go);function Ft(...e){let t={},{opts:i,stream:r}=Bl(t,Yu(),...e);i.level&&typeof i.level=="string"&&wo[i.level.toLowerCase()]!==void 0&&(i.level=i.level.toLowerCase());let{redact:n,crlf:o,serializers:s,timestamp:a,messageKey:c,errorKey:m,nestedKey:f,base:u,name:g,level:d,customLevels:l,levelComparison:h,mixin:w,mixinMergeStrategy:v,useOnlyCustomLevels:b,formatters:S,hooks:x,depthLimit:E,edgeLimit:O,onChild:A,msgPrefix:M}=i,C=el({maximumDepth:E,maximumBreadth:O}),R=cl(S.level,S.bindings,S.log),q=zt.bind({[Wt]:C}),P=n?Qu(n,q):{},D=n?{stringify:P[fl]}:{stringify:q},L="}"+(o?`\r
`:`
`),te=al.bind(null,{[co]:"",[uo]:s,[fo]:P,[lo]:zt,[Wt]:C,[mo]:R}),Xe="";u!==null&&(g===void 0?Xe=te(u):Xe=te(Object.assign({},u,{name:g})));let ar=a instanceof Function?a:a?bo:Ol,_n=ar().indexOf(":")+1;if(b&&!l)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(w&&typeof w!="function")throw Error(`Unknown mixin type "${typeof w}" - expected "function"`);if(M&&typeof M!="string")throw Error(`Unknown msgPrefix type "${typeof M}" - expected "string"`);tl(d,l,b);let cr=yo(l,b);typeof r.emit=="function"&&r.emit("message",{code:"PINO_CONFIG",config:{levels:cr,messageKey:c,errorKey:m}}),ol(h);let Rn=il(h);return Object.assign(t,{levels:cr,[xl]:Rn,[Cl]:b,[gl]:r,[dl]:ar,[ml]:_n,[lo]:zt,[Wt]:C,[fo]:P,[hl]:L,[yl]:D,[wl]:c,[bl]:m,[vl]:f,[El]:f?`,${JSON.stringify(f)}:{`:"",[uo]:s,[Sl]:w,[$l]:v,[co]:Xe,[mo]:R,[kl]:x,silent:ul,onChild:A,[Il]:M}),Object.setPrototypeOf(t,Zu()),rl(t),t[pl](d),t}J.exports=Ft;J.exports.destination=(e=process.stdout.fd)=>typeof e=="object"?(e.dest=ao(e.dest||process.stdout.fd),so(e)):so({dest:ao(e),minLength:0});J.exports.transport=Ot();J.exports.multistream=no();J.exports.levels=yo();J.exports.stdSerializers=Nl;J.exports.stdTimeFunctions=Object.assign({},po);J.exports.symbols=ho;J.exports.version=ll;J.exports.default=Ft;J.exports.pino=Ft});var He=B(require("@whiskeysockets/baileys")),An=B(vo());var Q=require("winston"),Ht=B(require("fs")),De=B(require("path")),{combine:Vt,timestamp:Pl,printf:Tl,colorize:Gl}=Q.format,je=De.default.join(__dirname,"../logs/");Ht.default.existsSync(je)||Ht.default.mkdirSync(je);var Kt=Tl(({level:e,message:t,timestamp:i})=>`${i} [${e}: ${t}]`),So=(0,Q.createLogger)({format:Vt(Pl({format:"DD-MM-YYYY HH:mm:ss"}),Kt),transports:[new Q.transports.Console({format:Vt(Gl(),Kt)}),new Q.transports.File({format:Vt(Kt),filename:De.default.join(je,"app.log")})]});So.add(new Q.transports.File({filename:De.default.join(je,"error.log"),level:"error"}));var y=So;var Xt={};Un(Xt,{extractNumbers:()=>Ul,extractUrls:()=>ql,getExtensionFromUrl:()=>Jl,removeDuplicates:()=>jl,validateRemoteJid:()=>Ll,verifyIfFFMPEGisInstalled:()=>Dl});var xo=B(require("linkifyjs")),Co=require("child_process");var Ul=e=>e.match(/-?\d+/g)??[],ql=e=>xo.find(e).map(t=>t.value),jl=e=>[...new Set(e)],Dl=()=>new Promise(e=>{let t=(0,Co.spawn)("ffmpeg",["-version"]);t.on("error",()=>e(!1)),t.stdout.on("data",i=>{i.toString().toLowerCase().includes("ffmpeg")&&e(!0)}),t.stderr.on("data",i=>{i.toString().toLowerCase().includes("ffmpeg")&&e(!0)}),t.on("close",i=>{i!==0&&e(!1)})}),Ll=e=>{let t="@s.whatsapp.net",i="@g.us",r=e.split("@")[0];return e.endsWith(i)?{phoneNumber:r,type:"group"}:e.endsWith(t)?{phoneNumber:r,type:"private"}:{phoneNumber:r,type:"unknown"}},Jl=e=>e.split(".").pop()?.toLowerCase()||"";var vn=require("@whiskeysockets/baileys");var $o=require("dotenv");var ko=B(require("axios"));var ve=class extends Error{message;code;constructor(t,i){super(t),this.message=t,this.code=i}};var zl=e=>{if(e.response){let{status:t,data:i}=e.response,r=typeof i=="string"?i:i?.message||"Erro inesperado";throw new ve(r,t)}throw new ve("Erro de conex\xE3o ou resposta inv\xE1lida")},Eo=e=>{let t=ko.default.create({baseURL:e,timeout:5e3,headers:{"Content-Type":"application/json"}}),i=async r=>{try{return(await r()).data}catch(n){zl(n)}};return{get:(r,n)=>i(()=>t.get(r,n)),post:(r,n,o)=>i(()=>t.post(r,n,o)),put:(r,n,o)=>i(()=>t.put(r,n,o)),patch:(r,n,o)=>i(()=>t.patch(r,n,o)),delete:(r,n)=>i(()=>t.delete(r,n))}};(0,$o.config)();var{BACKEND_URL:Le}=process.env,{PREFIX:Wl}=process.env;console.log(Le);console.log(Wl);if(!Le||Le.length===0)throw new Error("Url do backend n\xE3o definida");var $=Eo(Le);var Yt="advertence",Qt={newAdvertence:`${Yt}/add-advertence`,removeAdvertence:`${Yt}/remove-advertence`,removedExpiredAdvertences:`${Yt}/remove-expired-advertences`},le={add:async e=>await $.post(Qt.newAdvertence,e).then(t=>t).catch(t=>t.code===409?t.message:(y.error(`${JSON.stringify(t)}`),null)),remove:async e=>await $.patch(Qt.removeAdvertence,e).then(t=>t).catch(t=>(y.warn(`Erro ao remover advert\xEAncia ${JSON.stringify(t)}`),t.code===500?t.message:null)),cleanAll:async()=>await $.post(Qt.removedExpiredAdvertences).then(e=>y.info(`${e}`)).catch(e=>y.warn(`Erro ao limpar todas as advert\xEAncias ${JSON.stringify(e)}`))};var Fl={command:{name:"add-adv",aliases:["add-adv"],category:"modera\xE7\xE3o",usage:"add-adv @9999999999 (motivo)",description:"Adiciona uma advert\xEAncia ao usu\xE1rio especificado. Limite de 3 advert\xEAncias"},async execute(e,t,i,r,n){let o=r.mentions?.[0],s=e.utils.validateRemoteJid(o).phoneNumber,c=i.replace(/@\d+\s*/,"").trim()||"Sem motivo informado";if(!r.isGroup){await r.reply("Este comando s\xF3 pode ser usado em grupos.");return}if(!o){await r.reply("Voc\xEA precisa marcar um usu\xE1rio para advertir.");return}let m=await le.add({userRemoteJid:s,whatsappGroupId:r.from,reason:c});typeof m=="string"?await r.reply(`N\xE3o foi poss\xEDvel advertir: ${m}`):m?await r.reply(`@${s} foi advertido. Motivo:
${c}`):(await r.reply("Erro ao advertir o usu\xE1rio."),e.log.error(`Erro ao adicionar advert\xEAncia para ${o} no grupo ${r.from}`))}},Io=Fl;var Oo=B(require("form-data")),Ao=require("buffer"),Zt="messages",er={getMessage:e=>`${Zt}/${e}`,attachMedia:e=>`${Zt}/add-media-to-message/${e}`,getMedia:e=>`${Zt}/upload/${e}`},k={getMessage:async(e,t)=>await $.get(er.getMessage(`${e}:${t}`)).then(i=>i).catch(i=>(y.error(`${JSON.stringify(i)}`),null)),attachMediaToMessage:async(e,t,i,r)=>{let n=new Oo.default;return n.append("file",t,{contentType:i,filename:r}),await $.patch(er.attachMedia(e),n,{headers:n.getHeaders()}).then(o=>o).catch(o=>(y.warn("Erro ao enviar m\xEDdia para a mensagem: "+JSON.stringify(o)),o.message))},getMedia:async e=>{try{let t=await $.get(er.getMedia(e),{responseType:"arraybuffer"});return Ao.Buffer.from(t)}catch(t){return y.error("Erro ao resgatar m\xEDdia: "+JSON.stringify(t)),null}}};var rr=B(require("fs")),To=B(require("path"));var Se=require("@whiskeysockets/baileys");var z=B(require("fs-extra")),Mo=B(require("path")),_o=B(require("crypto")),ze=B(require("fluent-ffmpeg")),Ro=B(require("node-webpmux")),Bo=B(require("file-type")),No=B(require("jimp"));var Z=class extends Error{message;constructor(t){super(t),this.message=t}};function Je(e){let t=`${Date.now()}_${Math.floor(Math.random()*1e4)}.${e}`;return Mo.default.join(__dirname,"../temp",t)}async function Vl(e){return new Promise((t,i)=>{ze.default.ffprobe(e,(r,n)=>{r?i(r):t(n.format.duration||0)})})}async function Po(e,{pack:t="",author:i="",fps:r=9,type:n="resize"}){let o=await Bo.default.fromBuffer(e);if(!o)throw new Z("Tipo de m\xEDdia n\xE3o identificado");let s=o.mime,a=s.startsWith("video")||s.includes("gif");if(a&&e.length>5*1024*1024)throw new Z("\u274C O v\xEDdeo excede 5MB, n\xE3o \xE9 poss\xEDvel criar a figurinha.");s==="image/webp"&&(e=await Hl(e));let c=await Kl(e,a,r,n);return await tr(c,t,i)}async function Kl(e,t,i,r){let n=Je(t?"mp4":"png"),o=Je("webp");if(!t&&r!=="resize"&&(e=await Xl(e,r)),await z.default.writeFile(n,e),t&&await Vl(n)>10)throw await z.default.unlink(n),new Z("\u274C O v\xEDdeo tem mais de 10 segundos. Use um v\xEDdeo mais curto.");try{let s=t?["-vcodec","libwebp","-filter:v",`fps=${i}`,"-lossless","1","-compression_level","6","-q:v","50","-loop","0","-preset","default","-an","-vsync","0","-s","512:512","-t","6"]:["-vcodec","libwebp","-loop","0","-lossless","1","-q:v","100","-preset","picture",,"-pix_fmt","yuva420p","-vf","scale=512:512:force_original_aspect_ratio=decrease:eval=frame,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000"];return await new Promise((c,m)=>{(0,ze.default)(n).outputOptions(s).save(o).on("end",c).on("error",m)}),await z.default.readFile(o)}finally{await z.default.pathExists(o)&&await z.default.unlink(o),await z.default.pathExists(n)&&await z.default.unlink(n)}}async function Hl(e){let t=Je("webp"),i=Je("png");await z.default.writeFile(t,e),await new Promise((n,o)=>{(0,ze.default)(t).save(i).on("end",n).on("error",o)});let r=await z.default.readFile(i);return await z.default.unlink(t),await z.default.unlink(i),r}async function Xl(e,t){y.error(`${JSON.stringify(e)}`),y.error(`${JSON.stringify(t)}`);let i=await No.default.read(e);if(t==="contain")i.contain(512,512);else if(t==="circle")i.resize(512,512),i.circle();else return e;return i.getBufferAsync("image/png")}async function tr(e,t,i){let r=new Ro.default.Image,o={"sticker-pack-id":_o.default.randomBytes(32).toString("hex"),"sticker-pack-name":t,"sticker-pack-publisher":i},s=Buffer.from([73,73,42,0,8,0,0,0,1,0,65,87,7,0,0,0,0,0,22,0,0,0]),a=Buffer.from(JSON.stringify(o),"utf8"),c=Buffer.concat([s,a]);return c.writeUIntLE(a.length,14,4),await r.load(e),r.exif=c,r.save(null)}async function se(e){try{let t=e.message||e;if(!t)return null;t.ephemeralMessage&&(t=t.ephemeralMessage.message),t.viewOnceMessageV2&&(t=t.viewOnceMessageV2.message);let i=(0,Se.getContentType)(t);if(!i)return null;let r=t[i];if(!r||!r.url||!r.mediaKey||!r.directPath)return null;let n=await(0,Se.downloadContentFromMessage)(r,i.replace("Message","")),o=[];for await(let s of n)o.push(s);return Buffer.concat(o)}catch(t){return y.error(`Erro ao baixar m\xEDdia: ${JSON.stringify(t)}`),Buffer.from([])}}function ir(){let e=To.default.join(__dirname,"..","temp");return rr.default.existsSync(e)||rr.default.mkdirSync(e,{recursive:!0}),e}var Yl={command:{name:"sticker",aliases:["s","figurinha","stiker","f"],category:"utilidades",usage:"[marque m\xEDdia] |Nome Pacote|Autor",description:"Converte imagens, v\xEDdeos e GIFs em figurinhas"},async execute(e,t,i,r){let n=ir();y.info("Executando comando de sticker..."),await r.reply("\u23F1\uFE0F Aguarde a cria\xE7\xE3o do seu sticker").catch(g=>y.warn("Erro ao enviar mensagem de espera: ",JSON.stringify(g)));let o=r.quoted?.message||r.message,s=(0,Se.getContentType)(o)??"",a=["imageMessage","videoMessage","stickerMessage"];if(y.info("Tipo detectado da m\xEDdia:",s),!a.includes(s))return y.warn("Tipo de m\xEDdia n\xE3o suportado:",s),r.reply("\u274C *Envie ou marque uma imagem, v\xEDdeo ou GIF*.");let c=i.split("|"),m=c[1]?.trim()||`${e.config.name} 2.0`,f=c[2]?.trim()||e.config.name,u=await se(r.quoted??r);if(!u||u.length===0)return y.warn("Buffer vazio ou m\xEDdia indispon\xEDvel para download"),r.reply("\u274C N\xE3o consegui baixar a m\xEDdia. Talvez tenha expirado ou sido apagada.");try{let g=await Po(u,{pack:m,author:f,fps:9,type:"resize"});await e.sendMessage(r.from,{sticker:g},{quoted:r}),y.info("Figurinha enviada com sucesso.")}catch(g){g instanceof Z?(y.warn(`Erro espec\xEDfico de figurinha: ${JSON.stringify(g)}`),await r.reply(`${g.message}`)):(y.error("Erro na cria\xE7\xE3o do sticker:",g),await r.reply("\u274C Ocorreu um erro ao criar a figurinha. Tente novamente."))}}},Go=Yl;var Uo=B(require("mime-types")),Ql={command:{name:"add-img",aliases:["add-img"],category:"modera\xE7\xE3o",usage:"add-img [tipo] (respondendo a imagem/gif)",description:'Adiciona uma imagem ou gif a uma mensagem personalizada. Os tipos podem ser "welcome-message" e "goodbye-message"'},async execute(e,t,i,r){let n=["welcome-message","goodbye-message"],o=i.trim();if(!n.includes(o)){await r.reply("\u274C Tipo inv\xE1lido. Use 'welcome-message' ou 'goodbye-message'.");return}if(!r.quoted||!r.quoted.message){await r.reply("\u274C Responda a uma imagem ou gif para adicionar \xE0 mensagem.");return}let a=(await e.groupMetadata(r.from).catch(()=>null)).id;if(!a){await r.reply("\u274C N\xE3o foi poss\xEDvel identificar o nome do grupo.");return}let c=await k.getMessage(o,a);if(!c||typeof c=="string"){await r.reply("\u274C A mensagem ainda n\xE3o foi criada. Use o comando correspondente para criar antes de adicionar imagem.");return}let m=await se(r.quoted);if(!m||m.length===0){await r.reply("\u274C N\xE3o foi poss\xEDvel baixar o conte\xFAdo da imagem.");return}let f=Object.keys(r.quoted.message||{})[0],u=Uo.default.extension(r.quoted.message?.[f]?.mimetype||"")||"jpg",g=`img-${Date.now()}.${u}`,d=await k.attachMediaToMessage(c.id,m,r.quoted.message?.[f]?.mimetype,g);typeof d=="string"?await r.reply(`\u274C Erro ao adicionar imagem: ${d}`):await r.reply("\u2705 Imagem adicionada com sucesso \xE0 mensagem!")}},qo=Ql;var T="groups",G={newGroup:()=>`${T}/new-group`,updateGroup:e=>`${T}/update-group/${e}`,inactivateGroup:e=>`${T}/inactivate-group/${e}`,reactivateGroup:e=>`${T}/reactivate-group/${e}`,addUserToGroup:()=>`${T}/add-user-to-group`,inactivateUserFromGroup:()=>`${T}/inactivate-user-from-group`,reactivateUserFromGroup:()=>`${T}/reactivate-user-from-group`,getReport:e=>`${T}/get-report/${e}`,allGroupsCount:()=>`${T}/all-groups-count`,getMostActiveMembers:(e,t)=>`${T}/get-most-active-members-from-group/${e}?qty=${t}`,activateWelcome:e=>`${T}/activate-welcome-message/${e}`,inactivateWelcome:e=>`${T}/deactivate-welcome-message/${e}`,activateGoodbye:e=>`${T}/activate-goodbye-message/${e}`,inactivateGoodbye:e=>`${T}/deactivate-goodbye-message/${e}`,checkMessagesStatus:e=>`${T}/check-groups-messages-status/${e}`,editWelcomeMessage:()=>`${T}/edit-welcome-message`,editGoodbyeMessage:()=>`${T}/edit-goodbye-message`},_={createNewGroup:async e=>await $.post(G.newGroup(),e).then(t=>(y.info("Grupo cadastrado com sucesso"),y.info(`${JSON.stringify(t)}`),t)).catch(t=>(y.warn(`Erro ao cadastrar novo grupo: ${JSON.stringify(t)}`),t.code===400?!1:null)),updateGroup:async(e,t)=>await $.post(G.updateGroup(e),t).then(i=>(y.info("Grupo cadastrado com sucesso"),y.info(`${JSON.stringify(i)}`),i)).catch(i=>(y.warn(`Erro ao cadastrar novo grupo: ${JSON.stringify(i)}`),null)),inactivateGroup:async e=>await $.post(G.inactivateGroup(e)).then(t=>(y.info("Grupo inativado"),y.info(`${JSON.stringify(t)}`),t)).catch(t=>(y.warn("Erro ao inativar grupo"),y.warn(`${JSON.stringify(t)}`),null)),reactivateGroup:async e=>await $.patch(G.reactivateGroup(e)).then(t=>(y.info("Grupo reativado"),y.info(`${JSON.stringify(t)}`),t)).catch(t=>(y.warn("Erro ao reativar grupo"),y.warn(`${JSON.stringify(t)}`),null)),addUserToGroup:async e=>await $.post(G.addUserToGroup(),e).then(t=>(y.info(`Novo usu\xE1rio no grupo **${t.grupo.nomeGrupo}**`),y.info(`${JSON.stringify(t)}`),!0)).catch(t=>(y.warn("Erro ao adicionar usu\xE1rio a grupo"),y.warn(`${JSON.stringify(t)}`),t.code===409?!1:null)),inactivateUserFromGroup:async e=>await $.put(G.inactivateUserFromGroup(),e).then(t=>(y.info(`Usu\xE1rio ${t.usuario.remoteJid} acaba de sair do grupo ${t.grupo.nomeGrupo}`),t)).catch(t=>(y.warn("Erro ao remover usu\xE1rio do grupo"),y.warn(`${JSON.stringify(t)}`),null)),reactivateUserFromGroup:async e=>await $.put(G.reactivateUserFromGroup(),e).then(t=>(y.info(`Usu\xE1rio ${t.usuario.remoteJid} acaba de voltar pro grupo ${t.grupo.nomeGrupo}`),t)).catch(t=>(y.warn("Erro ao reativar usu\xE1rio do grupo"),y.warn(`${JSON.stringify(t)}`),null)),groupReport:async e=>await $.get(G.getReport(e)).then(t=>t).catch(t=>(y.warn(`Houve um erro: ${JSON.stringify(t)}`),t.message)),allGroupsCount:async()=>await $.get(G.allGroupsCount()).then(e=>e),usersRank:async(e,t)=>(t===void 0&&(t=5),await $.get(G.getMostActiveMembers(e,t)).then(i=>i).catch(i=>(y.warn(`Um erro ocorreu ao buscar o rank ${i}`),i.message))),activateWelcome:async e=>await $.patch(G.activateWelcome(e)).then(t=>t).catch(t=>(y.warn(`Erro ao ativar mensagem de boas vindas: ${JSON.stringify(t)}`),t.message)),inactivateWelcome:async e=>await $.patch(G.inactivateWelcome(e)).then(t=>t).catch(t=>(y.warn(`Erro ao desativar mensagem de boas vindas: ${JSON.stringify(t)}`),t.message)),activateGoodbye:async e=>await $.patch(G.activateGoodbye(e)).then(t=>t).catch(t=>(y.warn(`Erro ao ativar mensagem de despedidas: ${JSON.stringify(t)}`),t.message)),inactivateGoodbye:async e=>await $.patch(G.inactivateGoodbye(e)).then(t=>t).catch(t=>(y.warn(`Erro ao desativar mensagem de despedidas: ${JSON.stringify(t)}`),t.message)),verifyMessageStatus:async e=>await $.get(G.checkMessagesStatus(e)).then(t=>t).catch(t=>(y.warn(`Erro ao ativar mensagem de despedidas: ${JSON.stringify(t)}`),t.message)),editWelcomeMessage:async e=>await $.patch(G.editWelcomeMessage(),e).then(t=>t).catch(t=>(y.warn("Erro ao atualizar mensagem de grupo"),t.message)),editGoodbyeMessage:async e=>await $.patch(G.editGoodbyeMessage(),e).then(t=>t).catch(t=>(y.warn("Erro ao atualizar mensagem de grupo"),t.message))};var Zl={command:{name:"at-adeus",aliases:["at-adeus"],category:"modera\xE7\xE3o",usage:"at-adeus 1 (ativa) ou at-adeus 0 (desativa)",description:"Ativa ou desativa as mensagens de despedida no grupo."},execute:async function(e,t,i,r,n){let o=i.trim(),s=r.from;if(o!=="0"&&o!=="1"){await r.reply("Use 1 para ativar ou 0 para desativar as mensagens de adeus.");return}let a=o==="1"?await _.activateGoodbye(s):await _.inactivateGoodbye(s);await r.reply(a)}},jo=Zl;var ef={command:{name:"at-bv",aliases:["at-bv"],category:"modera\xE7\xE3o",usage:"at-bv 1 (ativa) ou at-bv 0 (desativa)",description:"Ativa ou desativa as mensagens de boas-vindas no grupo."},execute:async function(e,t,i,r,n){let o=i.trim(),s=r.from;if(o!=="0"&&o!=="1"){await r.reply("Use 1 para ativar ou 0 para desativar as boas-vindas.");return}let a=o==="1"?await _.activateWelcome(s):await _.inactivateWelcome(s);await r.reply(a)}},Do=ef;var We="ban",Fe={createBan:`${We}/create-ban`,findBannedUsersFromGroup:e=>`${We}/find-banned-users-from-group/${e}`,findBan:`${We}/find-ban`,removeBan:()=>`${We}/remove-ban`},fe={add:async e=>await $.post(Fe.createBan,e).then(t=>t).catch(t=>t.code===409?t.message:null),remove:async(e,t)=>await $.patch(Fe.removeBan(),{userRemoteJid:e,groupRemoteJid:t}).then(i=>i).catch(i=>(y.warn(`Erro ao remover banimento ${JSON.stringify(i)}`),i.code===500?i.message:null)),findOne:async e=>await $.get(Fe.findBan,{params:e}).then(t=>t).catch(t=>(y.warn(`Erro ao buscar banimento: ${JSON.stringify(t)}`),null)),listGroupBans:async e=>await $.get(Fe.findBannedUsersFromGroup(e)).then(t=>t).catch(t=>(y.warn(`Erro ao listar usu\xE1rios banidos: ${JSON.stringify(t)}`),null))};var tf={command:{name:"ban",aliases:["ban"],category:"modera\xE7\xE3o",usage:"ban @9999999999 <motivo>",description:"Bane o usu\xE1rio mencionado do grupo."},execute:async function(e,t,i,r,n){let o=r.mentions?.[0],s=e.utils.validateRemoteJid(o).phoneNumber,c=i.replace(/@\d+\s*/,"").trim()||"Sem motivo informado";if(!r.isGroup){await r.reply("Este comando s\xF3 pode ser usado em grupos.");return}if(!o){await r.reply("Voc\xEA precisa marcar um usu\xE1rio para banir.");return}if(!c){await r.reply("Voc\xEA precisa informar o motivo do banimento.");return}let m={userRemoteJid:s,groupRemoteJid:r.from,motivoBan:c},f=await fe.add(m);typeof f=="string"?await r.reply(f):f?(await e.groupParticipantsUpdate(r.from,r.mentions,"remove"),await r.reply("Usu\xE1rio banido com sucesso.")):await r.reply("Erro ao banir o usu\xE1rio.")}},Lo=tf;var rf={command:{name:"chance",aliases:["chance"],category:"brincadeiras",usage:"chance [mensagem]",description:"Diz a chance de algo acontecer."},execute:async function(e,t,i,r,n){let o=await k.getMessage("joke","chance");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}if(!i){await r.reply("\u26A0\uFE0F Escreva uma situa\xE7\xE3o para calcular a chance.");return}let s=Math.floor(Math.random()*101),a=o.mensagem.replace("{MSG}",i).replace("{PERCENTAGE}",`${s}`),c=o.midia?await k.getMedia(o.midia):null,m=o.midia?e.utils.getExtensionFromUrl(o.midia):"",f;c?m==="mp4"?f={gifPlayback:!0,video:c,caption:a}:f={image:c,caption:a}:f={text:a};try{await e.sendMessage(r.from,{...f,mentions:[r.sender]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},Jo=rf;var of={command:{name:"delete",aliases:["del"],category:"modera\xE7\xE3o",usage:"del (responda a mensagem)",description:"Deleta a mensagem especificada (responder/quotar)."},async execute(e,t,i,r){if(!r.quoted){await r.reply("\u{1F7E5} *Responda a mensagem que voc\xEA quer apagar!*");return}let n=r.isGroup,o=r.quoted.key;if(n){let s=await e.groupMetadata(r.from),a=e.user.id.split(":")[0]+"@s.whatsapp.net",c=r.sender,m=s.participants.find(d=>d.id===a),f=s.participants.find(d=>d.id===c),u=m?.admin==="admin",g=f?.admin==="admin"||f?.admin==="superadmin";if(!u){await r.reply("\u{1F7E5} *N\xE3o posso apagar mensagens, n\xE3o sou admin nesse grupo.*");return}if(!g){await r.reply("\u{1F7E5} *Apenas administradores podem executar este comando!*");return}}await e.sendMessage(r.from,{delete:{remoteJid:r.from,fromMe:o.fromMe,id:o.id,participant:r.quoted.participant}})}},zo=of;var nf={command:{name:"divorciar",aliases:["divorciar"],category:"brincadeiras",usage:"divorciar @usu\xE1rio",description:"Voc\xEA se divorcia de algu\xE9m do grupo."},execute:async function(e,t,i,r,n){if(!r.mentions.length){await r.reply("\u274C Voc\xEA precisa marcar algu\xE9m para se divorciar!");return}let o=await k.getMessage("joke","divorciar");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let s,a=o.midia?await k.getMedia(o.midia):null,c=o.midia?e.utils.getExtensionFromUrl(o.midia):"",m=r.mentions[0],f=o.mensagem.replace("{A}",`@${r.sender.split("@")[0]}`).replace("{B}",`@${m.split("@")[0]}`);a?c==="mp4"?s={gifPlayback:!0,video:a,caption:f}:s={image:a,caption:f}:s={text:f};try{await e.sendMessage(r.from,{...s,mentions:[r.sender,m]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},Wo=nf;var sf={command:{name:"edit-adeus",aliases:["edit-adeus"],category:"modera\xE7\xE3o",usage:"edit-adeus <nova mensagem>",description:"Edita a mensagem de despedida do grupo."},execute:async function(e,t,i,r,n){let o=i.trim(),s=r.from;if(!o){await r.reply("\u2757 Voc\xEA precisa informar a nova mensagem de despedida.");return}let a={groupRemoteJid:s,messageContent:o},c=await _.editGoodbyeMessage(a);typeof c=="string"?await r.reply(`\u26A0\uFE0F Erro ao atualizar mensagem de despedida:
${c}`):await r.reply("\u2705 Mensagem de despedida atualizada com sucesso!")}},Fo=sf;var af={command:{name:"edit-bv",aliases:["edit-bv"],category:"modera\xE7\xE3o",usage:"edit-bv <nova mensagem>",description:"Edita a mensagem de boas-vindas do grupo."},execute:async function(e,t,i,r,n){let o=i.trim(),s=r.from;if(console.log(r.from),!o){await r.reply("\u2757 Voc\xEA precisa informar a nova mensagem de boas-vindas.");return}let a={groupRemoteJid:s,messageContent:o},c=await _.editWelcomeMessage(a);typeof c=="string"?await r.reply(`\u26A0\uFE0F Erro ao atualizar mensagem de boas-vindas:
${c}`):await r.reply("\u2705 Mensagem de boas-vindas atualizada com sucesso!")}},Vo=af;var cf={command:{name:"gay",aliases:["gay"],category:"brincadeiras",usage:"gay @usu\xE1rio",description:'Mostra o n\xEDvel de "gaydade" de um membro mencionado.'},execute:async function(e,t,i,r,n){let o=r.mentions?.[0],s=Math.floor(Math.random()*101),a=await k.getMessage("joke","gay");if(!o){await r.reply("\u274C Voc\xEA precisa mencionar algu\xE9m. Ex: /gay @usu\xE1rio");return}if(!a||!a.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let c,m=a.midia?await k.getMedia(a.midia):null,f=a.midia?e.utils.getExtensionFromUrl(a.midia):"",u=a.mensagem.replace("{A}",`@${o.split("@")[0]}`).replace("{PERCENTAGE}",`${s}`);m?f==="mp4"?c={gifPlayback:!0,video:m,caption:u}:c={image:m,caption:u}:c={text:u};try{await e.sendMessage(r.from,{...c,mentions:[o]},{quoted:r})}catch(g){let d=new Date;await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
Servidor interno fora do ar ou outro erro.
Hor\xE1rio do erro: ${d.toString()}`}),e.log.error(`${JSON.stringify(g)}`)}}},Ko=cf;var uf={command:{name:"help",aliases:["help","ajuda","?"],category:"geral",usage:"help {comando}",description:"Mostra informa\xE7\xF5es detalhadas sobre um comando espec\xEDfico"},async execute(e,t,i,r,n){if(!i){e.sendMessage(r.from,{text:`\u26A0\uFE0F Uso correto: ${e.config.prefix}help [comando]
Exemplo: ${e.config.prefix}help sticker`},{quoted:r});return}let o=i.toLowerCase().trim(),s=e.cmd.get(o);if(!s){for(let[,l]of e.cmd.entries())if(l.command.aliases?.includes(o)){s=l;break}return}if(!s){e.sendMessage(r.from,{text:`\u274C Comando "${o}" n\xE3o encontrado. Use ${e.config.prefix}menu para ver todos os comandos dispon\xEDveis.`},{quoted:r});return}let{prefix:a}=e.config,{name:c,description:m,aliases:f,category:u,usage:g}=s.command,d=`*\u{1F4DA} AJUDA: ${c}*

`;d+=`\u{1F4DD} *Descri\xE7\xE3o*: ${m||"Sem descri\xE7\xE3o"}

`,f?.length&&(d+=`\u{1F504} *Aliases*: ${f.map(l=>`${a}${l}`).join(", ")}

`),u&&(d+=`\u{1F3F7}\uFE0F *Categoria*: ${u}

`),g&&(d+=`\u{1F4BB} *Uso*: ${a}${c} ${g}

`),await e.sendMessage(r.from,{text:d},{quoted:r})}},Ho=uf;var lf={command:{name:"gostosa",aliases:["gostosa"],category:"brincadeiras",usage:"gostosa [@usu\xE1rio]",description:"Mostra o n\xEDvel de gostosura de algu\xE9m."},execute:async function(e,t,i,r,n){let o=await k.getMessage("joke","gostosa");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let s=r.mentions[0];if(!s){let g=await e.groupMetadata(r.from).catch(()=>null);if(!g){await r.reply("\u274C N\xE3o foi poss\xEDvel obter os membros do grupo.");return}let d=g.participants.filter(h=>h.id!==e.user.id),l=d[Math.floor(Math.random()*d.length)];if(!l){await r.reply("\u274C Grupo sem participantes v\xE1lidos.");return}s=l.id}let a,c=o.midia?await k.getMedia(o.midia):null,m=o.midia?e.utils.getExtensionFromUrl(o.midia):"",f=Math.floor(Math.random()*101),u=o.mensagem.replace("{A}",`@${s.split("@")[0]}`).replace("{PERCENTAGE}",String(f));c?m==="mp4"?a={gifPlayback:!0,video:c,caption:u}:a={image:c,caption:u}:a={text:u};try{await e.sendMessage(r.from,{...a,mentions:[s]},{quoted:r})}catch(g){let d=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${d.toString()}`}),e.log.error(`${JSON.stringify(g)}`)}}},Xo=lf;var ff={command:{name:"beijar",aliases:["beijar"],category:"brincadeiras",usage:"beijar @usu\xE1rio",description:"Beija outro usu\xE1rio do grupo."},execute:async function(e,t,i,r,n){let o=r.mentions?.[0];if(!o){await r.reply("\u{1F6AB} Voc\xEA precisa marcar algu\xE9m para beijar!");return}let s=await k.getMessage("joke","beijar");if(!s||!s.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no Servidor.");return}let a,c=s.midia?await k.getMedia(s.midia):null,m=s.midia?e.utils.getExtensionFromUrl(s.midia):"",f=`${s.mensagem} @${o.split("@")[0]}`;c?m==="mp4"?a={gifPlayback:!0,video:c,caption:f}:a={image:c,caption:f}:a={text:f};try{await e.sendMessage(r.from,{...a,mentions:[o]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},Yo=ff;var df={command:{name:"casar",aliases:["casar"],category:"brincadeiras",usage:"casar @usu\xE1rio",description:"Casa voc\xEA com outro membro do grupo."},execute:async function(e,t,i,r,n){if(!r.mentions.length){await r.reply("\u274C Voc\xEA precisa marcar algu\xE9m para se casar!");return}let o=await k.getMessage("joke","casar");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let s,a=o.midia?await k.getMedia(o.midia):null,c=o.midia?e.utils.getExtensionFromUrl(o.midia):"",m=r.mentions[0],f=o.mensagem.replace("{A}",`@${r.sender.split("@")[0]}`).replace("{B}",`@${m.split("@")[0]}`);a?c==="mp4"?s={gifPlayback:!0,video:a,caption:f}:s={image:a,caption:f}:s={text:f};try{await e.sendMessage(r.from,{...s,mentions:[r.sender,m]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},Qo=df;var mf={command:{name:"mention-all",aliases:["totag"],category:"modera\xE7\xE3o",usage:"totag {mensagem}",description:"Menciona todos os membros do grupo de uma s\xF3 vez."},async execute(e,t,i,r,n){if(!r.isGroup)return;let o=await e.groupMetadata(r.from),s=r.sender.split("@")[0],c=`Men\xE7\xE3o do ADM ${r.pushName} @${s}`,m=o.participants.map(u=>u.id)||[],f="";if(r.body?.startsWith(`${e.config.prefix}totag`)?f=r.body.replace(`${e.config.prefix}totag`,"").trim():r.quoted?.text&&(f=r.quoted.text.trim()),!f){await r.reply("\u{1F7E5} *Mencione uma mensagem com seu aviso ou digite o comando com o aviso*");return}await e.sendMessage(r.from,{text:`${c}
${f}`,mentions:m})}},Zo=mf;var gf={command:{name:"menu",aliases:["menu"],category:"geral",usage:"| [cmd]",description:"Mostra lista de comandos"},async execute(e,t,i,r,n){if(!e.cmd)return;let o=e.config.prefix,s={geral:[],modera\u00E7\u00E3o:[],utilidades:[],brincadeiras:[]};for(let f of e.cmd.values()){let u=f.command.category;if(!s[u])continue;let g=`${o}${f.command.aliases[0]}`;s[u].push(`\u{1F539} *${g}* \u2014 ${f.command.description}`)}let a=i.trim().toLowerCase();if(a&&s[a]){let f=s[a];if(!f.length){await e.sendMessage(r.from,{text:`\u26A0\uFE0F Nenhum comando encontrado na categoria *${a}*.`},{quoted:r});return}let g=`\u{1F4C2} *Categoria: ${a[0].toUpperCase()+a.slice(1)}*

${f.join(`
`)}`;await e.sendMessage(r.from,{text:g},{quoted:r});return}let m=`*\u{1F4CB} CATEGORIAS DISPON\xCDVEIS:*

${Object.keys(s).map(f=>`\u{1F4C2} *${f[0].toUpperCase()+f.slice(1)}* \u2192 use \`${o}menu ${f}\``).join(`
`)}

Use o comando acima para ver os comandos da categoria.`;await e.sendMessage(r.from,{text:m},{quoted:r})}},en=gf;var pf={command:{name:"status-mensagens",aliases:["msg-status"],category:"modera\xE7\xE3o",usage:"msg-status",description:"Mostra se as mensagens de boas-vindas e despedida est\xE3o ativas."},execute:async function(e,t,i,r,n){let o=r.from,s=await _.verifyMessageStatus(o);if(typeof s=="string"){await r.reply(`\u26A0\uFE0F Erro ao consultar status das mensagens:
${s}`);return}let a=s.isWelcomeMessageActive?"\u2705 Ativada":"\u274C Desativada",c=s.isGoodByeMessageActive?"\u2705 Ativada":"\u274C Desativada";await r.reply(`\u{1F4E2} *Status das Mensagens:*
- Boas-vindas: ${a}
- Despedida: ${c}`)}},tn=pf;var hf={command:{name:"cutucar",aliases:["cutucar"],category:"brincadeiras",usage:"cutucar @usu\xE1rio",description:"Cutuca algu\xE9m do grupo."},execute:async function(e,t,i,r,n){let o=await k.getMessage("joke","cutucar");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let s=r.mentions[0];if(!s){await r.reply("\u26A0\uFE0F Voc\xEA precisa mencionar algu\xE9m para cutucar.");return}let a,c=`@${r.sender.split("@")[0]}`,m=`@${s.split("@")[0]}`,f=o.midia?await k.getMedia(o.midia):null,u=o.midia?e.utils.getExtensionFromUrl(o.midia):"",g=o.mensagem.replace("{A}",c).replace("{B}",m);f?u==="mp4"?a={gifPlayback:!0,video:f,caption:g}:a={image:f,caption:g}:a={text:g};try{await e.sendMessage(r.from,{...a,mentions:[r.sender,s]},{quoted:r})}catch(d){let l=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${l.toString()}`}),e.log.error(`${JSON.stringify(d)}`)}}},rn=hf;var yf={command:{name:"rank",aliases:["rank"],category:"geral",usage:"rank [quantidade]",description:"Exibe o ranking dos usu\xE1rios mais ativos do grupo."},execute:async function(e,t,i,r,n){let o=r.from,s=Number(i.trim())||void 0,a=await _.usersRank(o,s);if(typeof a=="string"){await r.reply(`\u26A0\uFE0F Erro ao consultar o ranking:
${a}`);return}if(!Array.isArray(a)||a.length===0){await r.reply("\u26A0\uFE0F Nenhum dado de ranking encontrado.");return}let c=a.map((m,f)=>`${f+1}. ${m.nome} - ${m.quantidadeMensagens} mensagens - ${m.comandosExecutados} comandos`).join(`
`);await r.reply(`\u{1F3C6} *Ranking dos mais ativos:*

${c}`)}},on=yf;var wf={command:{name:"rem-adv",aliases:["rem-adv"],category:"modera\xE7\xE3o",usage:"rem-adv @9999999999",description:"Remove uma advert\xEAncia do usu\xE1rio especificado."},execute:async function(e,t,i,r,n){let o=r.mentions?.[0],s=e.utils.validateRemoteJid(o).phoneNumber;if(!r.isGroup){await r.reply("Este comando s\xF3 pode ser usado em grupos.");return}if(!o){await r.reply("Voc\xEA precisa marcar um usu\xE1rio para remover advert\xEAncia.");return}let a=await le.remove({userRemoteJid:s,whatsappGroupId:r.from,activeAdvertences:!0});typeof a=="string"?await r.reply(`N\xE3o foi poss\xEDvel remover a advert\xEAncia: ${a}`):a?await r.reply("Advert\xEAncia removida com sucesso."):(await r.reply("Erro ao remover a advert\xEAncia."),e.log.error(`Erro ao remover advert\xEAncia para ${o} no grupo ${r.from}`))}},nn=wf;var bf={command:{name:"remove",aliases:["rem"],category:"modera\xE7\xE3o",usage:"rem @usu\xE1rio",description:"Remove o(s) usu\xE1rio(s) mencionado(s). M\xE1ximo de 5 por vez."},async execute(e,t,i,r){if(!r.mentions.length){await r.reply("\u{1F7E5} *Mencione para remover*");return}let n=e.utils.removeDuplicates(r.mentions);if(n.length>5){await r.reply("\u{1F7E5} *Voc\xEA s\xF3 pode remover at\xE9 5 usu\xE1rios por vez!*");return}e.log.info(`Administrador ${r.from} est\xE1 removendo os seguintes usu\xE1rios: ${n}`),await e.groupParticipantsUpdate(r.from,n,"remove"),await r.reply(`\u{1F7E9} *Pronto! Removendo ${n.length} usu\xE1rios*`)}},sn=bf;var vf={command:{name:"rename",aliases:["rename","renomear","roubar"],category:"utilidades",usage:"[marque a figurinha] |Nome Pacote |Autor",description:"Renomeia uma figurinha com um novo pacote e autor."},async execute(e,t,i,r){if(!r.quoted||r.quoted.type!=="stickerMessage")return await r.reply("\u274C Por favor, marque a figurinha que deseja renomear.");await r.reply("\u23F1\uFE0F Renomeando figurinha...");let n=await se(r.quoted.message);if(!n||n.length===0)return r.reply("\u274C Falha ao baixar a m\xEDdia da figurinha.");let o=i.split("|"),s=o[0]?.trim()||`${e.config.name}`,a=o[1]?.trim()||"ChiakiBot 2.0";try{let c=await tr(n,s,a);await e.sendMessage(r.from,{sticker:c},{quoted:r})}catch(c){y.error("Erro ao renomear figurinha:",c),await r.reply("\u274C Ocorreu um erro ao aplicar os novos dados \xE0 figurinha.")}}},an=vf;var Sf={command:{name:"rico",aliases:["rico"],category:"brincadeiras",usage:"rico",description:"Descubra quanto dinheiro algu\xE9m teria."},execute:async function(e,t,i,r,n){let o=await k.getMessage("joke","rico");if(!o||!o.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let s,a=Math.floor(Math.random()*101),c=o.midia?await k.getMedia(o.midia):null,m=o.midia?e.utils.getExtensionFromUrl(o.midia):"",f=o.mensagem.replace("{A}",`@${r.sender.split("@")[0]}`).replace("{PERCENTAGE}",a.toString());c?m==="mp4"?s={gifPlayback:!0,video:c,caption:f}:s={image:c,caption:f}:s={text:f};try{await e.sendMessage(r.from,{...s,mentions:[r.sender]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},cn=Sf;var xf={command:{name:"shipp",aliases:["shipp"],category:"brincadeiras",usage:"shipp",description:"Cria um casal aleat\xF3rio no grupo."},execute:async function(e,t,i,r,n){let s=(await e.groupMetadata(r.from)).participants.map(h=>h.id).filter(h=>h!==e.user.id);if(s.length<2){await r.reply("\u274C Poucos membros para formar um casal.");return}let a=s[Math.floor(Math.random()*s.length)],c=s[Math.floor(Math.random()*s.length)];for(;a===c;)c=s[Math.floor(Math.random()*s.length)];let m=Math.floor(Math.random()*101),f=await k.getMessage("joke","shipp");if(!f||!f.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let u,g=f.midia?await k.getMedia(f.midia):null,d=f.midia?e.utils.getExtensionFromUrl(f.midia):"",l=f.mensagem.replace("{A}",`@${a.split("@")[0]}`).replace("{B}",`@${c.split("@")[0]}`).replace("{PERCENTAGE}",`${m}`);g?d==="mp4"?u={gifPlayback:!0,video:g,caption:l}:u={image:g,caption:l}:u={text:l};try{await e.sendMessage(r.from,{...u,mentions:[a,c]},{quoted:r})}catch(h){let w=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${w.toString()}`}),e.log.error(`${JSON.stringify(h)}`)}}},un=xf;var Cf={command:{name:"tapa",aliases:["tapa"],category:"brincadeiras",usage:"tapa @usu\xE1rio",description:"D\xE1 um tapa em algu\xE9m do grupo."},execute:async function(e,t,i,r,n){let o=r.mentions?.[0];if(!o){await r.reply("\u{1F6AB} Voc\xEA precisa marcar algu\xE9m para dar o tapa!");return}let s=await k.getMessage("joke","tapa");if(!s||!s.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let a,c=s.midia?await k.getMedia(s.midia):null,m=s.midia?e.utils.getExtensionFromUrl(s.midia):"",f=`${s.mensagem} @${o.split("@")[0]}`;c?m==="mp4"?a={gifPlayback:!0,video:c,caption:f}:a={image:c,caption:f}:a={text:f};try{await e.sendMessage(r.from,{...a,mentions:[o]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},ln=Cf;var kf={command:{name:"roubar",aliases:["roubar"],category:"brincadeiras",usage:"roubar @usu\xE1rio",description:"Rouba tudo de algu\xE9m no grupo."},execute:async function(e,t,i,r,n){let o=r.mentions?.[0];if(!o){await r.reply("\u274C Voc\xEA precisa mencionar algu\xE9m para roubar!");return}let s=await k.getMessage("joke","roubar");if(!s||!s.mensagem){await r.reply("\u274C Mensagem de brincadeira n\xE3o encontrada no backend.");return}let a,c=s.midia?await k.getMedia(s.midia):null,m=s.midia?e.utils.getExtensionFromUrl(s.midia):"",f=s.mensagem.replace("{A}",`@${r.sender.split("@")[0]}`).replace("{B}",`@${o.split("@")[0]}`);c?m==="mp4"?a={gifPlayback:!0,video:c,caption:f}:a={image:c,caption:f}:a={text:f};try{await e.sendMessage(r.from,{...a,mentions:[r.sender,o]},{quoted:r})}catch(u){let g=new Date(Date.now());await e.sendMessage(r.from,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro ${g.toString()}`}),e.log.error(`${JSON.stringify(u)}`)}}},fn=kf;var or=B(require("path")),xe=B(require("fs/promises")),dn=B(require("fluent-ffmpeg")),Ef={command:{name:"tomedia",aliases:["toimg","tovideo","tomedia"],category:"utilidades",usage:"[Marque uma figuinha",description:"Converte uma figurinha para imagem ou video"},async execute(e,t,i,r,n){if(!r.quoted||r.quoted.type!=="stickerMessage")return await r.reply("\u274C Por favor, marque a figurinha que deseja converter.");await r.reply("\u23F1\uFE0F Convertendo, aguarde...");let o=await se(r.quoted.message);if(!o||o.length===0)return r.reply("\u274C Falha ao baixar a m\xEDdia da figurinha.");let s=r.quoted.message?.stickerMessage?.isAnimated??!1,a=ir(),c=or.default.join(a,`input_${Date.now()}.webp`),m=or.default.join(a,`output_${Date.now()}.${s?"mp4":"png"}`);try{await xe.default.writeFile(c,o),await new Promise((u,g)=>{(0,dn.default)(c).output(m).on("end",u).on("error",g).run()});let f=await xe.default.readFile(m);s?await e.sendMessage(r.from,{video:f,gifPlayback:!0},{quoted:r}):await e.sendMessage(r.from,{image:f},{quoted:r})}catch(f){e.log.error("Erro ao converter figurinha:",f),await r.reply("\u274C Ocorreu um erro durante a convers\xE3o.")}finally{await xe.default.unlink(c).catch(f=>e.log.warn("Falha ao limpar inputPath")),await xe.default.unlink(m).catch(f=>e.log.warn("Falha ao limpar outputPath"))}}},mn=Ef;var $f={command:{name:"unban",aliases:["unban"],category:"modera\xE7\xE3o",usage:"unban @99999999",description:"Remove o banimento de um usu\xE1rio pelo ID do ban."},execute:async function(e,t,i,r,n){let o=r.from,s=r.mentions?.[0],a=null;if(!r.isGroup){await r.reply("Este comando s\xF3 pode ser usado em grupos.");return}if(s)a=e.utils.validateRemoteJid(s).phoneNumber;else if(i){let m=i.replace(/\D/g,"");a=e.utils.validateRemoteJid(m).phoneNumber}else{await r.reply("Voc\xEA precisa marcar ou informar o n\xFAmero do usu\xE1rio para desbanir.");return}let c=await fe.remove(a,o);typeof c=="string"?await r.reply(c):c?await r.reply("Usu\xE1rio desbanido com sucesso."):await r.reply("Erro ao desbanir o usu\xE1rio.")}},gn=$f;var If=[Ho,en,sn,Zo,zo,Go,Io,nn,Do,jo,Vo,Fo,Lo,gn,on,tn,qo,Yo,ln,Ko,un,fn,cn,Qo,Wo,Xo,rn,Jo,an,mn],pn=e=>(If.forEach(t=>{e.cmd.set(t.command.name,t),e.log.info(`Comando ${t.command.name} carregado com sucesso`)}),e);var hn=B(require("http"));var yn=require("socket.io"),Ve=!1,nr=hn.default.createServer(),de=new yn.Server(nr,{cors:{origin:"*",methods:["GET","POST"]}}),wn=()=>{if(!Ve)nr.listen(3001,"0.0.0.0",()=>{y.info("Servidor WebSocket rodando na porta 3001!")}),de.on("connection",e=>{y.info("Cliente conectado ao Socket.io"),e.on("disconnect",()=>{y.info("Cliente desconectado do Socket.io")})}),Ve=!0;else return},bn=()=>{if(Ve)de.close(),nr.close(()=>{y.info("Servidor WebSocket foi fechado.")}),Ve=!1;else return};var Ke=0,Of=e=>typeof e=="object"&&e!==null&&"isBoom"in e;async function Sn(e,t,i){let{qr:r,connection:n,lastDisconnect:o}=e;if(r&&(wn(),t.log.info("QR Code gerado, enviando para painel web"),de.emit("qr",r)),n==="open"&&(de.emit("status","online"),bn()),(n==="close"||n==="connecting")&&de.emit("staus","offline"),n==="close"){let s=Of(o?.error)&&o.error.output.statusCode!==vn.DisconnectReason.loggedOut;if(Ke>=5){y.error("Limite de tentativas excedido. Abortando.");return}y.warn(`Conex\xE3o encerrada. Reconectando (${Ke+1}/5)...`),Ke++,s&&await i()}n==="open"&&(Ke=0,y.info("Chiaki Bot! De p\xE9 e operante!"),pn(t))}var me="users",ge={newUser:`${me}/new`,incrementMessages:`${me}/update-message-quantity`,incrementCommands:`${me}/update-command-quantity`,getUser:`${me}/get-user`,newAdmin:`${me}/admin`,updateUser:`${me}/update-user`},U={newUser:async e=>await $.post(ge.newUser,e).then(t=>(y.info(`Novo usu\xE1rio criado: ${JSON.stringify(t)}`),!0)).catch(t=>(y.warn(t.message),!1)),incrementMessages:async e=>await $.post(ge.incrementMessages,e).then(t=>(y.info("Incremento de mensagens bem-sucessedido"),t)).catch(t=>(y.warn(`N\xE3o foi poss\xEDvel aumentar o n\xFAmero de mensagens do usu\xE1rio.
 ${t}`),t.code===422?!1:null)),incrementCommands:async e=>await $.post(ge.incrementCommands,e).then(t=>(y.info("Incremento de comandos bem-sucessedido"),t)).catch(t=>(y.warn(`N\xE3o foi poss\xEDvel aumentar o n\xFAmero de mensagens do usu\xE1rio.
 ${t}`),t.code===422?!1:null)),newAdmin:async e=>await $.post(ge.newAdmin,e).then(t=>(y.info(`Novo admin criado: ${JSON.stringify(t)}`),t)).catch(t=>(y.warn(t.message),null)),updateUser:async e=>await $.post(ge.updateUser,e).then(t=>(y.info(`Usu\xE1rio atualizado: ${JSON.stringify(t)}`),t)).catch(t=>(y.warn(t.message),null)),getUser:async e=>await $.get(`${ge.getUser}/${e}`).then(t=>t).catch(t=>(y.warn(t),t.code===404?null:!1))};async function xn(e,t){let i=t.user.id,r=i.includes(":")?i.replace(/:\d+/,""):i;if(e.action==="remove"&&e.participants.some(u=>u.split(":")[0]===r)){t.log.info(`Bot foi removido do grupo de id ${e.id}`);try{await _.inactivateGroup(e.id)}catch{t.log.warn(`Grupo "${e.id}" n\xE3o desativado (backend offline tolerado)`)}return}let o=null;try{o=await _.verifyMessageStatus(e.id)}catch{t.log.warn("[Backend offline tolerado] Erro ao verificar status de mensagens de grupo")}let s=await t.groupMetadata(e.id).catch(()=>null),a=null,c=null,m="",f=!1;if(e.action==="add")for(let u of e.participants){let g=t.utils.validateRemoteJid(u).phoneNumber;try{if(await fe.findOne({groupRemoteJid:e.id,userRemoteJid:g})){t.log.info(`Usu\xE1rio ${g} banido anteriormente. Removendo do grupo...`),f=!0;try{await t.groupParticipantsUpdate(e.id,[u],"remove")}catch(l){t.log.error(`Erro ao remover usu\xE1rio ${u}:`,l)}return}}catch{t.log.warn("[Backend offline tolerado] Erro ao verificar banimento")}try{let d=await U.getUser(g);d===null?(await U.newUser({remoteJid:g,userName:"S/N"}),await _.addUserToGroup({groupId:e.id,userId:g})):d!==!1&&d&&await _.reactivateUserFromGroup({userId:g,groupId:e.id})}catch{t.log.warn("[Backend offline tolerado] Erro ao registrar novo usu\xE1rio no grupo")}try{if(typeof o!="string"&&o?.isWelcomeMessageActive){let d=await k.getMessage("welcome-message",s?.subject);m=d.midia?t.utils.getExtensionFromUrl(d.midia):"",d===null?a=`Seja muito bem-vindo(a) ao nosso grupo! => *${s?.subject}* -

\u{1F488} *Descri\xE7\xE3o do Grupo:*
${s?.desc||"Sem descri\xE7\xE3o dispon\xEDvel."}

Siga as regras e se divirta!

*\u2023 ${e.participants.map(l=>`@${l.split("@")[0]}`).join(" ")}*`:(a=d.mensagem+`
@${g}`,d.midia&&(c=await k.getMedia(d.midia)))}}catch{t.log.warn("[Backend offline tolerado] Erro ao buscar mensagem de boas-vindas")}}else if(e.action==="remove")for(let u of e.participants){if(f)return;let g=t.utils.validateRemoteJid(u).phoneNumber;try{await _.inactivateUserFromGroup({groupId:e.id,userId:g})}catch{t.log.warn(`Usu\xE1rio ${g} n\xE3o desativado (backend offline)`)}try{if(typeof o!="string"&&o?.isGoodByeMessageActive){let d=await k.getMessage("goodbye-message",s?.subject);m=d.midia?t.utils.getExtensionFromUrl(d.midia):"",d===null?a=`Adeus *${e.participants.map(l=>`@${l.split("@")[0]}`).join(", ")}* \u{1F44B}\u{1F3FB}, sentiremos sua falta`:(a=d.mensagem,d.midia&&(c=await k.getMedia(d.midia)))}}catch{t.log.warn("[Backend offline tolerado] Erro ao buscar mensagem de despedida")}}else if(e.action==="promote"||e.action==="demote")for(let u of e.participants){let g=t.utils.validateRemoteJid(u).phoneNumber;try{let d=await U.getUser(g);d!==null&&typeof d!="boolean"&&await U.updateUser({remoteJid:d.remoteJid,name:d.nome,roleEnum:e.action==="promote"?2:3})}catch{t.log.warn(`[Backend offline tolerado] Erro ao atualizar cargo de ${g}`)}}if(a&&!c){await t.sendMessage(e.id,{text:a,mentions:e.participants});return}if(a&&c)try{let u;c?m==="mp4"?u={gifPlayback:!0,video:c,caption:a}:u={image:c,caption:a}:u={text:a},await t.sendMessage(e.id,{...u,mentions:e.participants})}catch(u){let g=new Date(Date.now());await t.sendMessage(e.id,{text:`Um erro inesperado ocorreu!
 Servidor interno fora do ar ou outro erro.
 Hor\xE1rio do erro: ${g.toString()}`}),t.log.error(`${JSON.stringify(u)}`)}}var En=require("@whiskeysockets/baileys");var ee=require("@whiskeysockets/baileys");function Af(e,t){return e?.conversation||e?.[t]?.text||e?.[t]?.caption||t==="listResponseMessage"&&e?.[t]?.singleSelectReply?.selectedRowId||t==="buttonsResponseMessage"&&e?.[t]?.selectedButtonId||t==="templateButtonReplyMessage"&&e?.[t]?.selectedId||""}function Mf(e,t){return e?.[t]?.text||e?.[t]?.description||e?.[t]?.caption||e?.[t]?.hydratedTemplate?.hydratedContentText||e?.[t]||""}async function Cn(e){try{let t=e.message||e;if(!t)return null;t.ephemeralMessage&&(t=t.ephemeralMessage.message),t.viewOnceMessageV2&&(t=t.viewOnceMessageV2.message);let i=(0,ee.getContentType)(t);if(!i)return null;let r=t[i];if(!r||!r.url||!r.mediaKey||!r.directPath)return null;let n=await(0,ee.downloadContentFromMessage)(r,i.replace("Message","")),o=[];for await(let s of n)o.push(s);return Buffer.concat(o)}catch(t){return y.error(`Erro ao baixar m\xEDdia: ${JSON.stringify(t)}`),Buffer.from([])}}var pe=e=>{let{user:t,server:i}=(0,ee.jidDecode)(e)||{};return t&&i?`${t}@${i}`.trim():e};function kn(e,t){if(!e||!e.key||!e.message)return{...e,id:"",from:"",sender:"",isGroup:!1,isSelf:!1,type:"",body:"",mentions:[],quoted:null,reply:async()=>{},download:async()=>Buffer.from([]),numbers:[],urls:[]};let i=e.key.id??"",r=e.key.fromMe??!1,n=pe(e.key.remoteJid??""),o=n.endsWith("@g.us"),s=o?pe(e.key.participant??""):r?pe(t.user.id):n,a=e.message;a?.ephemeralMessage&&(a=a.ephemeralMessage.message),a?.viewOnceMessageV2&&(a=a.viewOnceMessageV2.message);let c=(0,ee.getContentType)(a)??"",m=Af(a,c),f=null;try{let v=a?.[c]?.contextInfo;if(v?.quotedMessage){let b=v.quotedMessage,S="normal";b?.ephemeralMessage&&(b=b.ephemeralMessage.message,S="ephemeral"),b?.viewOnceMessageV2&&(b=b.viewOnceMessageV2.message,S="view_once");let x=(0,ee.getContentType)(b)??"",E=pe(v.participant??"");f={type:S,stanzaId:v.stanzaId??"",participant:E,message:b,mtype:x,isSelf:E===pe(t.user.id),text:Mf(b,x),key:{id:v.stanzaId,fromMe:E===pe(t.user.id),remoteJid:n},download:()=>Cn(b)}}}catch(v){t.log.error("Erro ao processar quoted message:",v)}let u=[];f?.participant&&u.push(f.participant);let g=a?.[c]?.contextInfo?.mentionedJid??[];u.push(...g.filter(Boolean));let d=(v,b={})=>t.sendMessage(n,{text:v},{quoted:e,...b}),l=()=>Cn(a),h=t.utils.extractNumbers(m),w=t.utils.extractUrls(m);return{...e,id:i,from:n,sender:s,isGroup:o,isSelf:r,type:c,body:m,mentions:u,quoted:f,reply:d,download:l,numbers:h,urls:w}}async function $n(e,t){if(y.info("---- Mensagens abaixo -----"),y.info(JSON.stringify(e)),!e.messages?.length||e.type!=="notify")return;let i=kn(JSON.parse(JSON.stringify(e.messages[0])),t);if(!i.message||!i.key||i.key.remoteJid==="status@broadcast"||["protocolMessage","senderKeyDistributionMessage","",null].includes(i.type))return;i.type==="viewOnceMessageV2"&&(i.message=i.message[i.type].message,i.type=(0,En.getContentType)(i.message));let{isGroup:r,sender:n,from:o,body:s}=i;if(!o||!n)return;let a="";try{a=t.utils.validateRemoteJid(n).phoneNumber}catch(m){t.log.warn("Erro ao validar remoteJid",m);return}let c=s.startsWith(t.config.prefix);try{let m=await U.getUser(a);m===!1?t.log.warn("Aviso: erro em getUser"):m===null&&a?await sr({remoteJid:a,userName:i.pushName||"S/N"},o):typeof m!="boolean"&&m.nome==="S/N"&&await U.updateUser({remoteJid:a,name:i.pushName,roleEnum:3})}catch(m){t.log.warn("[Backend offline tolerado] - falha em getUser/updateUser",m)}if(r){let m={groupRemoteJid:o,userRemoteJid:a},f=s?.startsWith(t.config.prefix);t.log.info(`[DEBUG] ${f?"Comando":"Mensagem"} detectado de ${a} no grupo ${o}`);try{if(f){let u=await U.incrementCommands(m);u===!1?(t.log.warn(`[WARN] Usu\xE1rio ${a} n\xE3o cadastrado no grupo. Tentando adicionar...`),await sr({remoteJid:a,userName:i.pushName},o)):u===null?t.log.warn("[WARN] Backend indispon\xEDvel para incrementar comandos"):t.log.info(`[OK] Comando incrementado para ${a}`)}else{let u=await U.incrementMessages(m);u===!1?(t.log.warn(`[WARN] Usu\xE1rio ${a} n\xE3o cadastrado no grupo. Tentando adicionar...`),await sr({remoteJid:a,userName:i.pushName},o)):u===null?t.log.warn("[WARN] Backend indispon\xEDvel para incrementar mensagens"):t.log.info(`[OK] Mensagem incrementada para ${a}`)}}catch(u){t.log.warn(`[Tolerado] Falha ao registrar comando/mensagem: ${u.message}`)}}try{if(!c)return;let m=s.slice(t.config.prefix.length).trim(),[f,...u]=m.split(" "),g=u.filter(h=>!h.startsWith("--")).join(" "),d=u.filter(h=>h.startsWith("--")),l=Array.from(t.cmd.values()).find(h=>h.command.aliases.includes(f));if(!l){await i.reply("\u{1F494} *Comando n\xE3o encontrado!!*");return}if(r&&l.command.category==="modera\xE7\xE3o"){let w=(await t.groupMetadata(o).catch(()=>null))?.participants.filter(b=>b.admin).map(b=>b.id)||[];if(!w.includes(n)){await i.reply("\u{1F7E8} *Usu\xE1rio n\xE3o \xE9 admin*");return}let v=t.user.id.split(":")[0]+"@s.whatsapp.net";if(!w.includes(v)){await i.reply(`\u{1F494} *Desculpe, o ${t.config.name} n\xE3o \xE9 um admin*`);return}}t.log.info(`Executando comando: ${l.command.name} para ${i.from}`),await l.execute(t,d,g,i,e.messages)}catch(m){t.log.error("[ERRO NO COMANDO] Mesmo sem backend, algo falhou ao executar comando:",m)}}async function sr(e,t){try{await U.newUser(e)||y.warn("Usu\xE1rio j\xE1 cadastrado ou backend offline"),await _.addUserToGroup({userId:e.remoteJid,groupId:t})||y.warn("Usu\xE1rio j\xE1 est\xE1 no grupo ou backend offline")}catch(i){y.warn("[Backend offline tolerado] Erro ao criar/adicionar usu\xE1rio ao grupo",i)}}async function In(e,t){let i=t.user.id,r=i.includes(":")?i.replace(/:\d+/,""):i,n=t.utils.validateRemoteJid(r).phoneNumber;for(let o of e){let s=o.id;t.log.info("---- Entrando em um novo grupo ----"),t.log.info(JSON.stringify(o.desc));try{await t.sendMessage(s,{text:` ---> *${t.config.name}* <--- 
 REALIZANDO CADASTRO EM UM NOVO GRUPO! 
 Ol\xE1 ${o.subject}\u{1F44B}`})}catch(c){t.log.warn(`[WHATSAPP] Falha ao enviar mensagem de entrada no grupo ${s}: ${c?.message}`);continue}let a=null;try{a=await _.createNewGroup({donoGrupoId:o.owner,nomeGrupo:o.subject,descricaoGrupo:o.desc,whatsappGroupId:s})}catch{t.log.warn("[Backend offline tolerado] Erro ao criar grupo")}if(a===null){try{await t.sendMessage(s,{text:"\u26A0\uFE0F Um erro inesperado ocorreu ao fazer cadastro do grupo! Retire-me do grupo e coloque de novo!"})}catch{}return}else if(a===!1)try{if(!await _.reactivateGroup(s)){await t.sendMessage(s,{text:"\u26A0\uFE0F Um erro inesperado ocorreu ao reativar!"});return}await t.sendMessage(s,{text:"Grupo Reativado! \xC9 bom estar de volta!"})}catch{t.log.warn("[Backend offline tolerado] Erro ao reativar grupo")}try{await t.sendMessage(s,{text:"\u2705 Cadastro do grupo feito com sucesso "}),await t.sendMessage(s,{text:" ---> Iniciando cadastro dos usu\xE1rios! <--- "})}catch(c){t.log.warn(`[WHATSAPP] Erro ao enviar mensagens de progresso para ${s}: ${c?.message}`)}for(let c of o.participants){let m=c.name?c.name:"S/N",f=c?.admin,u=t.utils.validateRemoteJid(c.id).phoneNumber,g={remoteJid:u,userName:m};if(u!==n){try{let d=await U.getUser(u);d===null&&!f&&await U.newUser(g),d===null&&(f==="admin"||f==="superadmin")&&await U.newAdmin(g),d===!1&&await t.sendMessage(s,{text:`Um erro inesperado ocorreu cadastrando o usu\xE1rio @${u}`})}catch{t.log.warn(`[Backend offline tolerado] Falha ao cadastrar usu\xE1rio ${u}`)}try{await _.addUserToGroup({groupId:s,userId:u})}catch{t.log.warn(`[Backend offline tolerado] Falha ao associar ${u} ao grupo`)}}}try{await t.sendMessage(s,{text:"\u2705 Cadastro do grupo completo! Bot pronto para uso!"}),await t.sendMessage(s,{text:`\u27A1\uFE0F Pr\xF3ximo passo:
 configurar mensagens personalizadas de entrada e sa\xEDda!
 Utilize o comando ${t.config.prefix}menu para saber mais`})}catch(c){t.log.warn(`[WHATSAPP] Erro ao enviar mensagem final para ${s}: ${c?.message}`)}}}async function On(e,t){t.log.info("---- Atualiza\xE7\xE3o de grupos ----"),t.log.info(JSON.stringify(e));for(let i of e){let r=i.id;await _.updateGroup(r,{descricaoGrupo:i?.desc,donoGrupoId:i?.owner,nomeGrupo:i?.subject,whatsappGroupId:r})||t.log.warn(`Um erro ocorreu na atualiza\xE7\xE3o do grupo ${i?.subject}`)}}function _f(){return{name:"ChiakiBot",prefix:process.env.PREFIX||"/"}}var Mn=async()=>{let{state:e,saveCreds:t}=await(0,He.useMultiFileAuthState)("session"),i=7*24*60*60*1e3,r=(0,He.default)({auth:e,logger:(0,An.default)({level:"silent"}),qrTimeout:20*1e3,shouldSyncHistoryMessage:()=>!1});return r.utils=Xt,r.config=_f(),r.cmd=new Map,r.log=y,await r.utils.verifyIfFFMPEGisInstalled()||(y.warn("O FFMPEG n\xE3o est\xE1 instalado, instale-o!"),process.exit(1)),r.ev.on("creds.update",t),r.ev.on("connection.update",async o=>await Sn(o,r,Mn)),r.ev.on("messages.upsert",async o=>await $n(o,r)),r.ev.on("groups.upsert",async o=>await In(o,r)),r.ev.on("groups.update",async o=>await On(o,r)),r.ev.on("group-participants.update",async o=>await xn(o,r)),setInterval(le.cleanAll,i),r};Mn().catch(e=>y.error(e));
